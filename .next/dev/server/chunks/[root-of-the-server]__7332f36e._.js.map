{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/devbridge/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 89, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/devbridge/src/lib/auth.ts"],"sourcesContent":["import { NextRequest } from 'next/server'\nimport jwt from 'jsonwebtoken'\nimport bcrypt from 'bcryptjs'\nimport { prisma } from './prisma'\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'fallback-secret-change-me'\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, 12)\n}\n\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n  return bcrypt.compare(password, hashedPassword)\n}\n\nexport function generateToken(userId: string): string {\n  return jwt.sign({ userId }, JWT_SECRET, { expiresIn: '7d' })\n}\n\nexport function verifyToken(token: string): { userId: string } | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as { userId: string }\n  } catch {\n    return null\n  }\n}\n\nexport async function validateToken(request: NextRequest): Promise<string | null> {\n  const authHeader = request.headers.get('authorization')\n  if (!authHeader?.startsWith('Bearer ')) {\n    return null\n  }\n\n  const token = authHeader.slice(7)\n  const payload = verifyToken(token)\n  if (!payload) {\n    return null\n  }\n\n  return payload.userId\n}\n\nexport async function getAuthUser(request: NextRequest) {\n  const authHeader = request.headers.get('authorization')\n  if (!authHeader?.startsWith('Bearer ')) {\n    return null\n  }\n\n  const token = authHeader.slice(7)\n  const payload = verifyToken(token)\n  if (!payload) {\n    return null\n  }\n\n  const user = await prisma.user.findUnique({\n    where: { id: payload.userId },\n    select: { id: true, email: true, name: true, isAdmin: true }\n  })\n\n  return user\n}\n\n// Helper function to check if user is admin (for use with already-fetched user)\nexport function isAdminUser(user: { isAdmin?: boolean } | null): boolean {\n  return user?.isAdmin === true\n}\n\nexport async function getProjectByApiKey(apiKey: string) {\n  const project = await prisma.project.findUnique({\n    where: { apiKey }\n  })\n  return project\n}\n\nexport async function validateApiKey(request: NextRequest) {\n  const apiKey = request.headers.get('x-api-key')\n  if (!apiKey) {\n    return null\n  }\n  return getProjectByApiKey(apiKey)\n}\n\nexport async function validateAdmin(request: NextRequest) {\n  const authHeader = request.headers.get('authorization')\n  if (!authHeader?.startsWith('Bearer ')) {\n    return null\n  }\n\n  const token = authHeader.slice(7)\n  const payload = verifyToken(token)\n  if (!payload) {\n    return null\n  }\n\n  const user = await prisma.user.findUnique({\n    where: { id: payload.userId },\n    select: { id: true, email: true, name: true, isAdmin: true }\n  })\n\n  if (!user || !user.isAdmin) {\n    return null\n  }\n\n  return user\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AACA;AACA;AACA;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,eAAe,aAAa,QAAgB;IACjD,OAAO,mMAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,eAAe,QAAgB,EAAE,cAAsB;IAC3E,OAAO,mMAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,SAAS,cAAc,MAAc;IAC1C,OAAO,2MAAG,CAAC,IAAI,CAAC;QAAE;IAAO,GAAG,YAAY;QAAE,WAAW;IAAK;AAC5D;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,2MAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,cAAc,OAAoB;IACtD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,OAAO,QAAQ,MAAM;AACvB;AAEO,eAAe,YAAY,OAAoB;IACpD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;QAC5B,QAAQ;YAAE,IAAI;YAAM,OAAO;YAAM,MAAM;YAAM,SAAS;QAAK;IAC7D;IAEA,OAAO;AACT;AAGO,SAAS,YAAY,IAAkC;IAC5D,OAAO,MAAM,YAAY;AAC3B;AAEO,eAAe,mBAAmB,MAAc;IACrD,MAAM,UAAU,MAAM,gIAAM,CAAC,OAAO,CAAC,UAAU,CAAC;QAC9C,OAAO;YAAE;QAAO;IAClB;IACA,OAAO;AACT;AAEO,eAAe,eAAe,OAAoB;IACvD,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;IACnC,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IACA,OAAO,mBAAmB;AAC5B;AAEO,eAAe,cAAc,OAAoB;IACtD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;QAC5B,QAAQ;YAAE,IAAI;YAAM,OAAO;YAAM,MAAM;YAAM,SAAS;QAAK;IAC7D;IAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,OAAO,EAAE;QAC1B,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 221, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/devbridge/src/lib/build.ts"],"sourcesContent":["import { prisma } from './prisma'\n\n// Feature registry for extensibility\nconst FEATURE_REGISTRY = {\n  business_config: {\n    name: 'Business Configuration',\n    snapshot: snapshotBusinessConfig,\n  },\n  localization: {\n    name: 'Localization',\n    snapshot: snapshotLocalization,\n  },\n  api_mocks: {\n    name: 'API Mocks',\n    snapshot: snapshotApiMocks,\n  },\n} as const\n\ntype FeatureType = keyof typeof FEATURE_REGISTRY\n\n/**\n * Snapshot current business config state (API response format)\n */\nasync function snapshotBusinessConfig(projectId: string) {\n  const configs = await prisma.businessConfig.findMany({\n    where: {\n      projectId,\n      isEnabled: true,\n    },\n    select: {\n      key: true,\n      valueType: true,\n      stringValue: true,\n      integerValue: true,\n      booleanValue: true,\n      decimalValue: true,\n      jsonValue: true,\n      imageUrl: true,\n      category: true,\n      version: true,\n      updatedAt: true,\n    },\n    orderBy: { key: 'asc' },\n  })\n\n  // Transform to API response format\n  const configMap: Record<string, unknown> = {}\n  const configMeta: Record<string, { type: string; category: string | null; version: number; updatedAt: string }> = {}\n\n  for (const config of configs) {\n    // Extract value based on type\n    let value: unknown = null\n    switch (config.valueType) {\n      case 'string':\n        value = config.stringValue\n        break\n      case 'integer':\n        value = config.integerValue\n        break\n      case 'boolean':\n        value = config.booleanValue\n        break\n      case 'decimal':\n        value = config.decimalValue\n        break\n      case 'json':\n        value = config.jsonValue\n        break\n      case 'image':\n        value = config.imageUrl\n        break\n    }\n\n    configMap[config.key] = value\n    configMeta[config.key] = {\n      type: config.valueType,\n      category: config.category,\n      version: config.version,\n      updatedAt: config.updatedAt.toISOString(),\n    }\n  }\n\n  return {\n    configs: configMap,\n    meta: configMeta,\n    fetchedAt: new Date().toISOString(),\n  }\n}\n\n/**\n * Snapshot current localization state (API response format)\n */\nasync function snapshotLocalization(projectId: string) {\n  const languages = await prisma.language.findMany({\n    where: { projectId },\n    include: {\n      translations: {\n        include: {\n          key: true,\n        },\n      },\n    },\n  })\n\n  // Transform to API response format\n  const translations: Record<string, Record<string, string>> = {}\n  const languageList: string[] = []\n\n  for (const lang of languages) {\n    languageList.push(lang.code)\n    translations[lang.code] = {}\n\n    for (const translation of lang.translations) {\n      translations[lang.code][translation.key.key] = translation.value\n    }\n  }\n\n  return {\n    translations,\n    languages: languageList,\n    fetchedAt: new Date().toISOString(),\n  }\n}\n\n/**\n * Snapshot current API Mocks state (API response format)\n */\nasync function snapshotApiMocks(projectId: string) {\n  const environments = await prisma.mockEnvironment.findMany({\n    where: { projectId },\n    include: {\n      endpoints: {\n        where: { isEnabled: true },\n        include: {\n          responses: {\n            where: { isEnabled: true },\n            include: {\n              conditions: true,\n            },\n            orderBy: [{ order: 'asc' }, { isDefault: 'desc' }],\n          },\n          conditions: true,\n        },\n        orderBy: { order: 'asc' },\n      },\n    },\n    orderBy: { createdAt: 'asc' },\n  })\n\n  // Transform to API response format\n  const environmentsData = environments.map((env) => ({\n    id: env.id,\n    name: env.name,\n    description: env.description,\n    basePath: env.basePath,\n    mode: env.mode,\n    whitelist: env.whitelist,\n    blacklist: env.blacklist,\n    isEnabled: env.isEnabled,\n    isDefault: env.isDefault,\n    endpoints: env.endpoints.map((endpoint) => ({\n      id: endpoint.id,\n      path: endpoint.path,\n      method: endpoint.method,\n      description: endpoint.description,\n      order: endpoint.order,\n      responses: endpoint.responses.map((response) => ({\n        id: response.id,\n        statusCode: response.statusCode,\n        name: response.name,\n        description: response.description,\n        responseBody: response.responseBody,\n        responseHeaders: response.responseHeaders,\n        delay: response.delay,\n        isDefault: response.isDefault,\n        order: response.order,\n        conditions: response.conditions.map((condition) => ({\n          type: condition.type,\n          key: condition.key,\n          operator: condition.operator,\n          value: condition.value,\n          isCaseSensitive: condition.isCaseSensitive,\n          order: condition.order,\n        })),\n      })),\n      conditions: endpoint.conditions.map((condition) => ({\n        type: condition.type,\n        key: condition.key,\n        operator: condition.operator,\n        value: condition.value,\n        isCaseSensitive: condition.isCaseSensitive,\n        order: condition.order,\n      })),\n    })),\n  }))\n\n  return {\n    environments: environmentsData,\n    fetchedAt: new Date().toISOString(),\n  }\n}\n\n/**\n * Compare two builds and generate change log\n */\nasync function compareBuilds(\n  projectId: string,\n  oldBuildId: string | null,\n  newBuildId: string,\n  userId: string\n) {\n  const newBuild = await prisma.build.findUnique({\n    where: { id: newBuildId },\n    include: {\n      features: true,\n    },\n  })\n\n  if (!newBuild) {\n    throw new Error('New build not found')\n  }\n\n  const changeLogs: Array<{\n    buildId: string\n    featureType: string\n    changeType: 'added' | 'deleted' | 'changed'\n    itemKey: string\n    itemLabel: string | null\n    oldValue: unknown\n    newValue: unknown\n    changedBy: string\n  }> = []\n\n  // If no old build, all items are \"added\"\n  if (!oldBuildId) {\n    for (const feature of newBuild.features) {\n      const snapshot = feature.snapshotData as Record<string, unknown>\n      \n      if (feature.featureType === 'business_config') {\n        const configs = snapshot.configs as Record<string, unknown>\n        for (const [key, value] of Object.entries(configs)) {\n          changeLogs.push({\n            buildId: newBuildId,\n            featureType: feature.featureType,\n            changeType: 'added',\n            itemKey: key,\n            itemLabel: key,\n            oldValue: null,\n            newValue: value,\n            changedBy: userId,\n          })\n        }\n      } else if (feature.featureType === 'localization') {\n        const translations = snapshot.translations as Record<string, Record<string, string>>\n        for (const [langCode, langTranslations] of Object.entries(translations)) {\n          for (const [key, value] of Object.entries(langTranslations)) {\n            changeLogs.push({\n              buildId: newBuildId,\n              featureType: feature.featureType,\n              changeType: 'added',\n              itemKey: `${langCode}:${key}`,\n              itemLabel: `${langCode}:${key}`,\n              oldValue: null,\n              newValue: value,\n              changedBy: userId,\n            })\n          }\n        }\n      } else if (feature.featureType === 'api_mocks') {\n        const environments = snapshot.environments as Array<{\n          id: string\n          name: string\n          endpoints: Array<{ id: string; path: string; method: string }>\n        }>\n        for (const env of environments) {\n          for (const endpoint of env.endpoints) {\n            changeLogs.push({\n              buildId: newBuildId,\n              featureType: feature.featureType,\n              changeType: 'added',\n              itemKey: `${env.id}:${endpoint.id}`,\n              itemLabel: `${env.name} - ${endpoint.method} ${endpoint.path}`,\n              oldValue: null,\n              newValue: endpoint,\n              changedBy: userId,\n            })\n          }\n        }\n      }\n    }\n  } else {\n    // Compare with previous build\n    const oldBuild = await prisma.build.findUnique({\n      where: { id: oldBuildId },\n      include: {\n        features: true,\n      },\n    })\n\n    if (oldBuild) {\n      // Compare each feature type\n      for (const featureType of Object.keys(FEATURE_REGISTRY) as FeatureType[]) {\n        const oldFeature = oldBuild.features.find(f => f.featureType === featureType)\n        const newFeature = newBuild.features.find(f => f.featureType === featureType)\n\n        const oldData = oldFeature?.snapshotData as Record<string, unknown> | undefined\n        const newData = newFeature?.snapshotData as Record<string, unknown> | undefined\n\n        if (featureType === 'business_config') {\n          const oldConfigs = oldData?.configs as Record<string, unknown> | undefined\n          const newConfigs = newData?.configs as Record<string, unknown> | undefined\n\n          // Find added and changed\n          if (newConfigs) {\n            for (const [key, newValue] of Object.entries(newConfigs)) {\n              const oldValue = oldConfigs?.[key]\n              if (oldValue === undefined) {\n                changeLogs.push({\n                  buildId: newBuildId,\n                  featureType,\n                  changeType: 'added',\n                  itemKey: key,\n                  itemLabel: key,\n                  oldValue: null,\n                  newValue,\n                  changedBy: userId,\n                })\n              } else if (JSON.stringify(oldValue) !== JSON.stringify(newValue)) {\n                changeLogs.push({\n                  buildId: newBuildId,\n                  featureType,\n                  changeType: 'changed',\n                  itemKey: key,\n                  itemLabel: key,\n                  oldValue,\n                  newValue,\n                  changedBy: userId,\n                })\n              }\n            }\n          }\n\n          // Find deleted\n          if (oldConfigs) {\n            for (const key of Object.keys(oldConfigs)) {\n              if (!newConfigs || !(key in newConfigs)) {\n                changeLogs.push({\n                  buildId: newBuildId,\n                  featureType,\n                  changeType: 'deleted',\n                  itemKey: key,\n                  itemLabel: key,\n                  oldValue: oldConfigs[key],\n                  newValue: null,\n                  changedBy: userId,\n                })\n              }\n            }\n          }\n        } else if (featureType === 'localization') {\n          const oldTranslations = oldData?.translations as Record<string, Record<string, string>> | undefined\n          const newTranslations = newData?.translations as Record<string, Record<string, string>> | undefined\n\n          // Find added and changed\n          if (newTranslations) {\n            for (const [langCode, langTranslations] of Object.entries(newTranslations)) {\n              for (const [key, newValue] of Object.entries(langTranslations)) {\n                const itemKey = `${langCode}:${key}`\n                const oldValue = oldTranslations?.[langCode]?.[key]\n                if (oldValue === undefined) {\n                  changeLogs.push({\n                    buildId: newBuildId,\n                    featureType,\n                    changeType: 'added',\n                    itemKey,\n                    itemLabel: itemKey,\n                    oldValue: null,\n                    newValue,\n                    changedBy: userId,\n                  })\n                } else if (oldValue !== newValue) {\n                  changeLogs.push({\n                    buildId: newBuildId,\n                    featureType,\n                    changeType: 'changed',\n                    itemKey,\n                    itemLabel: itemKey,\n                    oldValue,\n                    newValue,\n                    changedBy: userId,\n                  })\n                }\n              }\n            }\n          }\n\n          // Find deleted\n          if (oldTranslations) {\n            for (const [langCode, langTranslations] of Object.entries(oldTranslations)) {\n              for (const key of Object.keys(langTranslations)) {\n                const itemKey = `${langCode}:${key}`\n                if (!newTranslations?.[langCode] || !(key in newTranslations[langCode])) {\n                  changeLogs.push({\n                    buildId: newBuildId,\n                    featureType,\n                    changeType: 'deleted',\n                    itemKey,\n                    itemLabel: itemKey,\n                    oldValue: langTranslations[key],\n                    newValue: null,\n                    changedBy: userId,\n                  })\n                }\n              }\n            }\n          }\n        } else if (featureType === 'api_mocks') {\n          const oldEnvironments = oldData?.environments as Array<{\n            id: string\n            name: string\n            endpoints: Array<{ id: string; path: string; method: string; responses: any[] }>\n          }> | undefined\n          const newEnvironments = newData?.environments as Array<{\n            id: string\n            name: string\n            endpoints: Array<{ id: string; path: string; method: string; responses: any[] }>\n          }> | undefined\n\n          // Find added and changed endpoints\n          if (newEnvironments) {\n            for (const newEnv of newEnvironments) {\n              const oldEnv = oldEnvironments?.find(e => e.id === newEnv.id)\n              \n              for (const newEndpoint of newEnv.endpoints) {\n                const oldEndpoint = oldEnv?.endpoints.find(e => e.id === newEndpoint.id)\n                const itemKey = `${newEnv.id}:${newEndpoint.id}`\n                const itemLabel = `${newEnv.name} - ${newEndpoint.method} ${newEndpoint.path}`\n                \n                if (!oldEndpoint) {\n                  changeLogs.push({\n                    buildId: newBuildId,\n                    featureType,\n                    changeType: 'added',\n                    itemKey,\n                    itemLabel,\n                    oldValue: null,\n                    newValue: newEndpoint,\n                    changedBy: userId,\n                  })\n                } else if (JSON.stringify(oldEndpoint) !== JSON.stringify(newEndpoint)) {\n                  changeLogs.push({\n                    buildId: newBuildId,\n                    featureType,\n                    changeType: 'changed',\n                    itemKey,\n                    itemLabel,\n                    oldValue: oldEndpoint,\n                    newValue: newEndpoint,\n                    changedBy: userId,\n                  })\n                }\n              }\n            }\n          }\n\n          // Find deleted endpoints\n          if (oldEnvironments) {\n            for (const oldEnv of oldEnvironments) {\n              const newEnv = newEnvironments?.find(e => e.id === oldEnv.id)\n              \n              for (const oldEndpoint of oldEnv.endpoints) {\n                const exists = newEnv?.endpoints.some(e => e.id === oldEndpoint.id)\n                if (!exists) {\n                  changeLogs.push({\n                    buildId: newBuildId,\n                    featureType,\n                    changeType: 'deleted',\n                    itemKey: `${oldEnv.id}:${oldEndpoint.id}`,\n                    itemLabel: `${oldEnv.name} - ${oldEndpoint.method} ${oldEndpoint.path}`,\n                    oldValue: oldEndpoint,\n                    newValue: null,\n                    changedBy: userId,\n                  })\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  // Save change logs\n  if (changeLogs.length > 0) {\n    await prisma.buildChangeLog.createMany({\n      data: changeLogs.map(log => ({\n        buildId: log.buildId,\n        featureType: log.featureType,\n        changeType: log.changeType,\n        itemKey: log.itemKey,\n        itemLabel: log.itemLabel,\n        oldValue: log.oldValue as any,\n        newValue: log.newValue as any,\n        changedBy: log.changedBy,\n      })),\n    })\n  }\n\n  return changeLogs\n}\n\n/**\n * Create a new build for a specific feature type\n */\nexport async function createBuild(\n  projectId: string,\n  userId: string,\n  featureType: FeatureType,\n  name?: string,\n  description?: string\n) {\n  // Get next version number for this feature type\n  const lastBuild = await prisma.build.findFirst({\n    where: { \n      projectId,\n      features: {\n        some: {\n          featureType,\n        },\n      },\n    },\n    orderBy: { version: 'desc' },\n    select: { version: true },\n  })\n\n  const nextVersion = (lastBuild?.version || 0) + 1\n\n  // Get previous build for this feature type for comparison\n  const previousBuild = await prisma.build.findFirst({\n    where: {\n      projectId,\n      features: {\n        some: {\n          featureType,\n        },\n      },\n    },\n    orderBy: { version: 'desc' },\n    select: { id: true },\n  })\n\n  // Create snapshot for the specific feature\n  let snapshot: any\n  let itemCount = 0\n  let configCount = 0\n  let translationCount = 0\n\n  if (featureType === 'business_config') {\n    snapshot = await snapshotBusinessConfig(projectId)\n    itemCount = Object.keys(snapshot.configs).length\n    configCount = itemCount\n  } else if (featureType === 'localization') {\n    snapshot = await snapshotLocalization(projectId)\n    translationCount = Object.values(snapshot.translations).reduce(\n      (sum: number, lang: any) => sum + Object.keys(lang).length,\n      0\n    )\n    itemCount = translationCount\n  } else if (featureType === 'api_mocks') {\n    snapshot = await snapshotApiMocks(projectId)\n    // Count total endpoints across all environments\n    itemCount = snapshot.environments.reduce(\n      (sum: number, env: any) => sum + env.endpoints.length,\n      0\n    )\n  } else {\n    throw new Error(`Unknown feature type: ${featureType}`)\n  }\n\n  // Create build with only this feature\n  const build = await prisma.build.create({\n    data: {\n      projectId,\n      version: nextVersion,\n      name: name || `${FEATURE_REGISTRY[featureType].name} v${nextVersion}`,\n      description,\n      createdBy: userId,\n      businessConfigSnapshot: featureType === 'business_config' ? snapshot as any : null,\n      localizationSnapshot: featureType === 'localization' ? snapshot as any : null,\n      configCount,\n      translationCount,\n      features: {\n        create: [\n          {\n            featureType,\n            snapshotData: snapshot as any,\n            itemCount,\n          },\n        ],\n      },\n    },\n    include: {\n      features: true,\n    },\n  })\n\n  // Generate change log by comparing with previous build\n  await compareBuilds(projectId, previousBuild?.id || null, build.id, userId)\n\n  return build\n}\n\n/**\n * Get build by ID\n */\nexport async function getBuild(buildId: string) {\n  return prisma.build.findUnique({\n    where: { id: buildId },\n    include: {\n      features: true,\n      changeLogs: {\n        orderBy: { changedAt: 'desc' },\n      },\n      project: {\n        select: {\n          id: true,\n          name: true,\n        },\n      },\n    },\n  })\n}\n\n/**\n * Get user information for a build creator\n */\nexport async function getBuildCreator(userId: string | null) {\n  if (!userId) return null\n  return prisma.user.findUnique({\n    where: { id: userId },\n    select: {\n      id: true,\n      email: true,\n      name: true,\n    },\n  })\n}\n\n/**\n * List all builds for a project, optionally filtered by feature type\n */\nexport async function getBuildHistory(projectId: string, featureType?: string) {\n  const where: any = { projectId }\n  \n  if (featureType) {\n    where.features = {\n      some: {\n        featureType,\n      },\n    }\n  }\n\n  return prisma.build.findMany({\n    where,\n    include: {\n      features: true,\n      _count: {\n        select: {\n          changeLogs: true,\n        },\n      },\n    },\n    orderBy: { version: 'desc' },\n  })\n}\n\n/**\n * Get active build for a mode\n */\nexport async function getActiveBuild(projectId: string, mode: 'preview' | 'production') {\n  const buildMode = await prisma.buildMode.findUnique({\n    where: { projectId },\n    include: {\n      previewBuild: mode === 'preview',\n      productionBuild: mode === 'production',\n    },\n  })\n\n  if (!buildMode) {\n    return null\n  }\n\n  const buildId = mode === 'preview' ? buildMode.previewBuildId : buildMode.productionBuildId\n  if (!buildId) {\n    return null\n  }\n\n  return prisma.build.findUnique({\n    where: { id: buildId },\n    include: {\n      features: true,\n    },\n  })\n}\n\n/**\n * Set build mode (preview or production)\n */\nexport async function setBuildMode(\n  projectId: string,\n  buildId: string,\n  mode: 'preview' | 'production'\n) {\n  // Verify build belongs to project\n  const build = await prisma.build.findUnique({\n    where: { id: buildId },\n    select: { projectId: true },\n  })\n\n  if (!build || build.projectId !== projectId) {\n    throw new Error('Build not found or does not belong to project')\n  }\n\n  // Get or create BuildMode\n  let buildMode = await prisma.buildMode.findUnique({\n    where: { projectId },\n  })\n\n  if (!buildMode) {\n    buildMode = await prisma.buildMode.create({\n      data: { projectId },\n    })\n  }\n\n  // Deactivate previous build in same mode\n  const previousBuildId = mode === 'preview' ? buildMode.previewBuildId : buildMode.productionBuildId\n  if (previousBuildId) {\n    await prisma.build.update({\n      where: { id: previousBuildId },\n      data: { isActive: false },\n    })\n  }\n\n  // Activate new build\n  await prisma.build.update({\n    where: { id: buildId },\n    data: {\n      mode,\n      isActive: true,\n    },\n  })\n\n  // Update BuildMode\n  await prisma.buildMode.update({\n    where: { projectId },\n    data: {\n      previewBuildId: mode === 'preview' ? buildId : buildMode.previewBuildId,\n      productionBuildId: mode === 'production' ? buildId : buildMode.productionBuildId,\n    },\n  })\n\n  return prisma.build.findUnique({\n    where: { id: buildId },\n  })\n}\n\n/**\n * Update build name/description\n */\nexport async function updateBuild(buildId: string, data: { name?: string; description?: string }) {\n  return prisma.build.update({\n    where: { id: buildId },\n    data,\n  })\n}\n\n/**\n * Delete build\n */\nexport async function deleteBuild(buildId: string) {\n  // Check if build is active\n  const build = await prisma.build.findUnique({\n    where: { id: buildId },\n    select: { isActive: true, projectId: true },\n  })\n\n  if (!build) {\n    throw new Error('Build not found')\n  }\n\n  if (build.isActive) {\n    throw new Error('Cannot delete active build. Deactivate it first.')\n  }\n\n  // Remove from BuildMode if referenced\n  const buildMode = await prisma.buildMode.findUnique({\n    where: { projectId: build.projectId },\n  })\n\n  if (buildMode) {\n    const updates: { previewBuildId?: null; productionBuildId?: null } = {}\n    if (buildMode.previewBuildId === buildId) {\n      updates.previewBuildId = null\n    }\n    if (buildMode.productionBuildId === buildId) {\n      updates.productionBuildId = null\n    }\n\n    if (Object.keys(updates).length > 0) {\n      await prisma.buildMode.update({\n        where: { projectId: build.projectId },\n        data: updates,\n      })\n    }\n  }\n\n  // Delete build (cascade will delete features and change logs)\n  await prisma.build.delete({\n    where: { id: buildId },\n  })\n}\n\n/**\n * Get build diff (compare two builds)\n */\nexport async function getBuildDiff(buildId1: string, buildId2: string) {\n  const [build1, build2] = await Promise.all([\n    prisma.build.findUnique({\n      where: { id: buildId1 },\n      include: { features: true },\n    }),\n    prisma.build.findUnique({\n      where: { id: buildId2 },\n      include: { features: true },\n    }),\n  ])\n\n  if (!build1 || !build2) {\n    throw new Error('One or both builds not found')\n  }\n\n  // Use compare logic (similar to compareBuilds but return diff structure)\n  const diff: Record<string, Array<{\n    changeType: 'added' | 'deleted' | 'changed'\n    itemKey: string\n    itemLabel: string | null\n    oldValue: unknown\n    newValue: unknown\n  }>> = {}\n\n  for (const featureType of Object.keys(FEATURE_REGISTRY) as FeatureType[]) {\n    const feature1 = build1.features.find(f => f.featureType === featureType)\n    const feature2 = build2.features.find(f => f.featureType === featureType)\n\n    const data1 = feature1?.snapshotData as Record<string, unknown> | undefined\n    const data2 = feature2?.snapshotData as Record<string, unknown> | undefined\n\n    diff[featureType] = []\n\n    if (featureType === 'business_config') {\n      const configs1 = data1?.configs as Record<string, unknown> | undefined\n      const configs2 = data2?.configs as Record<string, unknown> | undefined\n\n      // Find added and changed\n      if (configs2) {\n        for (const [key, newValue] of Object.entries(configs2)) {\n          const oldValue = configs1?.[key]\n          if (oldValue === undefined) {\n            diff[featureType].push({\n              changeType: 'added',\n              itemKey: key,\n              itemLabel: key,\n              oldValue: null,\n              newValue,\n            })\n          } else if (JSON.stringify(oldValue) !== JSON.stringify(newValue)) {\n            diff[featureType].push({\n              changeType: 'changed',\n              itemKey: key,\n              itemLabel: key,\n              oldValue,\n              newValue,\n            })\n          }\n        }\n      }\n\n      // Find deleted\n      if (configs1) {\n        for (const key of Object.keys(configs1)) {\n          if (!configs2 || !(key in configs2)) {\n            diff[featureType].push({\n              changeType: 'deleted',\n              itemKey: key,\n              itemLabel: key,\n              oldValue: configs1[key],\n              newValue: null,\n            })\n          }\n        }\n      }\n    } else if (featureType === 'localization') {\n      const translations1 = data1?.translations as Record<string, Record<string, string>> | undefined\n      const translations2 = data2?.translations as Record<string, Record<string, string>> | undefined\n\n      // Find added and changed\n      if (translations2) {\n        for (const [langCode, langTranslations] of Object.entries(translations2)) {\n          for (const [key, newValue] of Object.entries(langTranslations)) {\n            const itemKey = `${langCode}:${key}`\n            const oldValue = translations1?.[langCode]?.[key]\n            if (oldValue === undefined) {\n              diff[featureType].push({\n                changeType: 'added',\n                itemKey,\n                itemLabel: itemKey,\n                oldValue: null,\n                newValue,\n              })\n            } else if (oldValue !== newValue) {\n              diff[featureType].push({\n                changeType: 'changed',\n                itemKey,\n                itemLabel: itemKey,\n                oldValue,\n                newValue,\n              })\n            }\n          }\n        }\n      }\n\n      // Find deleted\n      if (translations1) {\n        for (const [langCode, langTranslations] of Object.entries(translations1)) {\n          for (const key of Object.keys(langTranslations)) {\n            const itemKey = `${langCode}:${key}`\n            if (!translations2?.[langCode] || !(key in translations2[langCode])) {\n              diff[featureType].push({\n                changeType: 'deleted',\n                itemKey,\n                itemLabel: itemKey,\n                oldValue: langTranslations[key],\n                newValue: null,\n              })\n            }\n          }\n        }\n      }\n    }\n    \n    if (featureType === 'api_mocks') {\n        const envs1 = data1?.environments as Array<{\n          id: string\n          name: string\n          endpoints: Array<{ id: string; path: string; method: string; responses: any[] }>\n        }> | undefined\n        const envs2 = data2?.environments as Array<{\n          id: string\n          name: string\n          endpoints: Array<{ id: string; path: string; method: string; responses: any[] }>\n        }> | undefined\n\n        // Find added and changed endpoints\n        if (envs2) {\n          for (const env2 of envs2) {\n            const env1 = envs1?.find(e => e.id === env2.id)\n            \n            for (const endpoint2 of env2.endpoints) {\n              const endpoint1 = env1?.endpoints.find(e => e.id === endpoint2.id)\n              const itemKey = `${env2.id}:${endpoint2.id}`\n              const itemLabel = `${env2.name} - ${endpoint2.method} ${endpoint2.path}`\n              \n              if (!endpoint1) {\n                diff[featureType].push({\n                  changeType: 'added',\n                  itemKey,\n                  itemLabel,\n                  oldValue: null,\n                  newValue: endpoint2,\n                })\n              } else if (JSON.stringify(endpoint1) !== JSON.stringify(endpoint2)) {\n                diff[featureType].push({\n                  changeType: 'changed',\n                  itemKey,\n                  itemLabel,\n                  oldValue: endpoint1,\n                  newValue: endpoint2,\n                })\n              }\n            }\n          }\n        }\n\n        // Find deleted endpoints\n        if (envs1) {\n          for (const env1 of envs1) {\n            const env2 = envs2?.find(e => e.id === env1.id)\n            \n            for (const endpoint1 of env1.endpoints) {\n              const exists = env2?.endpoints.some(e => e.id === endpoint1.id)\n              if (!exists) {\n                diff[featureType].push({\n                  changeType: 'deleted',\n                  itemKey: `${env1.id}:${endpoint1.id}`,\n                  itemLabel: `${env1.name} - ${endpoint1.method} ${endpoint1.path}`,\n                  oldValue: endpoint1,\n                  newValue: null,\n                })\n              }\n            }\n          }\n        }\n    }\n  }\n\n  return {\n    build1: {\n      id: build1.id,\n      version: build1.version,\n      name: build1.name,\n      createdAt: build1.createdAt,\n    },\n    build2: {\n      id: build2.id,\n      version: build2.version,\n      name: build2.name,\n      createdAt: build2.createdAt,\n    },\n    diff,\n  }\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1191, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/devbridge/src/app/api/builds/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { getAuthUser } from '@/lib/auth'\nimport { createBuild, getBuildHistory, getBuildCreator } from '@/lib/build'\nimport { prisma } from '@/lib/prisma'\n\n/**\n * POST /api/builds - Create a new build\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const user = await getAuthUser(request)\n    if (!user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { projectId, featureType, name, description } = await request.json()\n\n    if (!projectId) {\n      return NextResponse.json({ error: 'projectId is required' }, { status: 400 })\n    }\n\n    if (!featureType || !['business_config', 'localization', 'api_mocks'].includes(featureType)) {\n      return NextResponse.json({ error: 'featureType is required and must be business_config, localization, or api_mocks' }, { status: 400 })\n    }\n\n    // Verify project ownership\n    const project = await prisma.project.findFirst({\n      where: {\n        id: projectId,\n        userId: user.id,\n      },\n    })\n\n    if (!project) {\n      return NextResponse.json({ error: 'Project not found' }, { status: 404 })\n    }\n\n    const build = await createBuild(projectId, user.id, featureType, name, description)\n\n    return NextResponse.json({ build })\n  } catch (error) {\n    console.error('Create build error:', error)\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n\n/**\n * GET /api/builds - List all builds for a project\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const user = await getAuthUser(request)\n    if (!user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { searchParams } = new URL(request.url)\n    const projectId = searchParams.get('projectId')\n    const featureType = searchParams.get('featureType')\n\n    if (!projectId) {\n      return NextResponse.json({ error: 'projectId is required' }, { status: 400 })\n    }\n\n    // Verify project ownership\n    const project = await prisma.project.findFirst({\n      where: {\n        id: projectId,\n        userId: user.id,\n      },\n    })\n\n    if (!project) {\n      return NextResponse.json({ error: 'Project not found' }, { status: 404 })\n    }\n\n    const builds = await getBuildHistory(projectId, featureType || undefined)\n\n    // Enrich builds with creator information\n    const buildsWithCreators = await Promise.all(\n      builds.map(async (build) => {\n        const creator = build.createdBy ? await getBuildCreator(build.createdBy) : null\n        return {\n          ...build,\n          creator: creator ? {\n            id: creator.id,\n            email: creator.email,\n            name: creator.name,\n          } : null,\n        }\n      })\n    )\n\n    return NextResponse.json({ builds: buildsWithCreators })\n  } catch (error) {\n    console.error('Get builds error:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\n"],"names":[],"mappings":"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"}}]
}