{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/devbridge/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 89, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/devbridge/src/lib/auth.ts"],"sourcesContent":["import { NextRequest } from 'next/server'\nimport jwt from 'jsonwebtoken'\nimport bcrypt from 'bcryptjs'\nimport { prisma } from './prisma'\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'fallback-secret-change-me'\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, 12)\n}\n\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n  return bcrypt.compare(password, hashedPassword)\n}\n\nexport function generateToken(userId: string): string {\n  return jwt.sign({ userId }, JWT_SECRET, { expiresIn: '7d' })\n}\n\nexport function verifyToken(token: string): { userId: string } | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as { userId: string }\n  } catch {\n    return null\n  }\n}\n\nexport async function validateToken(request: NextRequest): Promise<string | null> {\n  const authHeader = request.headers.get('authorization')\n  if (!authHeader?.startsWith('Bearer ')) {\n    return null\n  }\n\n  const token = authHeader.slice(7)\n  const payload = verifyToken(token)\n  if (!payload) {\n    return null\n  }\n\n  return payload.userId\n}\n\nexport async function getAuthUser(request: NextRequest) {\n  const authHeader = request.headers.get('authorization')\n  if (!authHeader?.startsWith('Bearer ')) {\n    return null\n  }\n\n  const token = authHeader.slice(7)\n  const payload = verifyToken(token)\n  if (!payload) {\n    return null\n  }\n\n  const user = await prisma.user.findUnique({\n    where: { id: payload.userId },\n    select: { id: true, email: true, name: true, isAdmin: true }\n  })\n\n  return user\n}\n\n// Helper function to check if user is admin (for use with already-fetched user)\nexport function isAdminUser(user: { isAdmin?: boolean } | null): boolean {\n  return user?.isAdmin === true\n}\n\nexport async function getProjectByApiKey(apiKey: string) {\n  const project = await prisma.project.findUnique({\n    where: { apiKey }\n  })\n  return project\n}\n\nexport async function validateApiKey(request: NextRequest) {\n  const apiKey = request.headers.get('x-api-key')\n  if (!apiKey) {\n    return null\n  }\n  return getProjectByApiKey(apiKey)\n}\n\nexport async function validateAdmin(request: NextRequest) {\n  const authHeader = request.headers.get('authorization')\n  if (!authHeader?.startsWith('Bearer ')) {\n    return null\n  }\n\n  const token = authHeader.slice(7)\n  const payload = verifyToken(token)\n  if (!payload) {\n    return null\n  }\n\n  const user = await prisma.user.findUnique({\n    where: { id: payload.userId },\n    select: { id: true, email: true, name: true, isAdmin: true }\n  })\n\n  if (!user || !user.isAdmin) {\n    return null\n  }\n\n  return user\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AACA;AACA;AACA;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,eAAe,aAAa,QAAgB;IACjD,OAAO,mMAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,eAAe,QAAgB,EAAE,cAAsB;IAC3E,OAAO,mMAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,SAAS,cAAc,MAAc;IAC1C,OAAO,2MAAG,CAAC,IAAI,CAAC;QAAE;IAAO,GAAG,YAAY;QAAE,WAAW;IAAK;AAC5D;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,2MAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,cAAc,OAAoB;IACtD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,OAAO,QAAQ,MAAM;AACvB;AAEO,eAAe,YAAY,OAAoB;IACpD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;QAC5B,QAAQ;YAAE,IAAI;YAAM,OAAO;YAAM,MAAM;YAAM,SAAS;QAAK;IAC7D;IAEA,OAAO;AACT;AAGO,SAAS,YAAY,IAAkC;IAC5D,OAAO,MAAM,YAAY;AAC3B;AAEO,eAAe,mBAAmB,MAAc;IACrD,MAAM,UAAU,MAAM,gIAAM,CAAC,OAAO,CAAC,UAAU,CAAC;QAC9C,OAAO;YAAE;QAAO;IAClB;IACA,OAAO;AACT;AAEO,eAAe,eAAe,OAAoB;IACvD,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;IACnC,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IACA,OAAO,mBAAmB;AAC5B;AAEO,eAAe,cAAc,OAAoB;IACtD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;QAC5B,QAAQ;YAAE,IAAI;YAAM,OAAO;YAAM,MAAM;YAAM,SAAS;QAAK;IAC7D;IAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,OAAO,EAAE;QAC1B,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 221, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/devbridge/src/lib/admin.ts"],"sourcesContent":["import { prisma } from './prisma'\n\n/**\n * Check if user is admin\n */\nexport async function isAdmin(userId: string): Promise<boolean> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n    select: { isAdmin: true },\n  })\n  return user?.isAdmin === true\n}\n\n/**\n * Get all users with their subscriptions\n */\nexport async function getAllUsers() {\n  return prisma.user.findMany({\n    include: {\n      subscription: {\n        include: {\n          plan: true,\n        },\n      },\n      projects: {\n        select: {\n          id: true,\n        },\n      },\n      _count: {\n        select: {\n          projects: true,\n        },\n      },\n    },\n    orderBy: {\n      createdAt: 'desc',\n    },\n  })\n}\n\n/**\n * Get all subscriptions with user details\n */\nexport async function getAllSubscriptions() {\n  return prisma.subscription.findMany({\n    include: {\n      user: {\n        select: {\n          id: true,\n          email: true,\n          name: true,\n        },\n      },\n      plan: {\n        select: {\n          id: true,\n          name: true,\n          displayName: true,\n          price: true,\n          maxProjects: true,\n          maxDevices: true,\n          maxMockEndpoints: true,\n          maxApiEndpoints: true,\n          maxApiRequests: true,\n          maxLogs: true,\n          maxSessions: true,\n          maxCrashes: true,\n          maxBusinessConfigKeys: true,\n          maxLocalizationLanguages: true,\n          maxLocalizationKeys: true,\n          retentionDays: true,\n        },\n      },\n      invoices: {\n        select: {\n          id: true,\n          amount: true,\n          status: true,\n          createdAt: true,\n        },\n        orderBy: {\n          createdAt: 'desc',\n        },\n        take: 1, // Latest invoice\n      },\n    },\n    orderBy: {\n      createdAt: 'desc',\n    },\n  })\n}\n\n/**\n * Enable a subscription (admin action)\n */\nexport async function enableSubscription(\n  subscriptionId: string,\n  adminUserId: string\n): Promise<void> {\n  await prisma.subscription.update({\n    where: { id: subscriptionId },\n    data: {\n      enabled: true,\n      enabledBy: adminUserId,\n      enabledAt: new Date(),\n      updatedAt: new Date(),\n    },\n  })\n}\n\n/**\n * Disable a subscription (admin action)\n */\nexport async function disableSubscription(\n  subscriptionId: string,\n  adminUserId: string\n): Promise<void> {\n  await prisma.subscription.update({\n    where: { id: subscriptionId },\n    data: {\n      enabled: false,\n      disabledBy: adminUserId,\n      disabledAt: new Date(),\n      updatedAt: new Date(),\n    },\n  })\n}\n\n/**\n * Get platform statistics (admin only)\n */\nexport async function getPlatformStats() {\n  const [\n    totalUsers,\n    activeSubscriptions,\n    expiredSubscriptions,\n    disabledSubscriptions,\n    totalProjects,\n    totalDevices,\n    totalApiTraces,\n    totalLogs,\n    totalSessions,\n    totalCrashes,\n    businessConfigs,\n    localizationKeys,\n  ] = await Promise.all([\n    prisma.user.count(),\n    prisma.subscription.count({\n      where: {\n        enabled: true,\n        status: 'active',\n      },\n    }),\n    prisma.subscription.count({\n      where: {\n        status: 'expired',\n      },\n    }),\n    prisma.subscription.count({\n      where: {\n        enabled: false,\n      },\n    }),\n    prisma.project.count(),\n    prisma.device.count(),\n    prisma.apiTrace.count(),\n    prisma.log.count(),\n    prisma.session.count(),\n    prisma.crash.count(),\n    prisma.businessConfig.count(),\n    prisma.localizationKey.count(),\n  ])\n\n  return {\n    users: {\n      total: totalUsers,\n      active: activeSubscriptions,\n      expired: expiredSubscriptions,\n      disabled: disabledSubscriptions,\n    },\n    platform: {\n      projects: totalProjects,\n      devices: totalDevices,\n      apiTraces: totalApiTraces,\n      logs: totalLogs,\n      sessions: totalSessions,\n      crashes: totalCrashes,\n    },\n    features: {\n      businessConfig: businessConfigs,\n      localization: localizationKeys,\n    },\n  }\n}\n\n/**\n * Get revenue statistics (admin only)\n */\nexport async function getRevenueStats() {\n  const subscriptions = await prisma.subscription.findMany({\n    include: {\n      plan: true,\n      invoices: {\n        where: {\n          status: 'paid',\n        },\n      },\n    },\n  })\n\n  const totalRevenue = subscriptions.reduce((sum, sub) => {\n    const invoiceTotal = sub.invoices.reduce((invoiceSum, inv) => invoiceSum + inv.amount, 0)\n    return sum + invoiceTotal\n  }, 0)\n\n  const activeSubscriptions = subscriptions.filter(\n    (sub) => sub.enabled && sub.status === 'active'\n  ).length\n\n  const expiredSubscriptions = subscriptions.filter(\n    (sub) => sub.status === 'expired'\n  ).length\n\n  return {\n    totalRevenue,\n    activeSubscriptions,\n    expiredSubscriptions,\n  }\n}\n\n/**\n * Get all plans with subscription counts\n */\nexport async function getAllPlans() {\n  return prisma.plan.findMany({\n    include: {\n      _count: {\n        select: {\n          subscriptions: true,\n        },\n      },\n    },\n    orderBy: {\n      price: 'asc',\n    },\n  })\n}\n\n/**\n * Get plan by ID\n */\nexport async function getPlanById(planId: string) {\n  return prisma.plan.findUnique({\n    where: { id: planId },\n    include: {\n      _count: {\n        select: {\n          subscriptions: true,\n        },\n      },\n    },\n  })\n}\n\n/**\n * Create a new plan (admin only)\n */\nexport async function createPlan(data: {\n  name: string\n  displayName: string\n  description?: string | null\n  price: number\n  currency?: string\n  interval?: string\n  isActive?: boolean\n  isPublic?: boolean\n  maxProjects?: number | null\n  maxDevices?: number | null\n  maxMockEndpoints?: number | null\n  maxApiEndpoints?: number | null\n  maxApiRequests?: number | null\n  maxLogs?: number | null\n  maxSessions?: number | null\n  maxCrashes?: number | null\n  retentionDays?: number | null\n  allowApiTracking?: boolean\n  allowScreenTracking?: boolean\n  allowCrashReporting?: boolean\n  allowLogging?: boolean\n  allowBusinessConfig?: boolean\n  allowLocalization?: boolean\n  allowCustomDomains?: boolean\n  allowWebhooks?: boolean\n  allowTeamMembers?: boolean\n  allowPrioritySupport?: boolean\n  enforcementConfig?: any\n}) {\n  return prisma.plan.create({\n    data: {\n      name: data.name,\n      displayName: data.displayName,\n      description: data.description || null,\n      price: data.price,\n      currency: data.currency || 'USD',\n      interval: data.interval || 'month',\n      isActive: data.isActive !== undefined ? data.isActive : true,\n      isPublic: data.isPublic !== undefined ? data.isPublic : true,\n      maxProjects: data.maxProjects ?? null,\n      maxDevices: data.maxDevices ?? null,\n      maxMockEndpoints: data.maxMockEndpoints ?? null,\n      maxApiEndpoints: data.maxApiEndpoints ?? null,\n      maxApiRequests: data.maxApiRequests ?? null,\n      maxLogs: data.maxLogs ?? null,\n      maxSessions: data.maxSessions ?? null,\n      maxCrashes: data.maxCrashes ?? null,\n      retentionDays: data.retentionDays ?? null,\n      allowApiTracking: data.allowApiTracking ?? true,\n      allowScreenTracking: data.allowScreenTracking ?? true,\n      allowCrashReporting: data.allowCrashReporting ?? true,\n      allowLogging: data.allowLogging ?? true,\n      allowBusinessConfig: data.allowBusinessConfig ?? true,\n      allowLocalization: data.allowLocalization ?? true,\n      allowCustomDomains: data.allowCustomDomains ?? false,\n      allowWebhooks: data.allowWebhooks ?? false,\n      allowTeamMembers: data.allowTeamMembers ?? false,\n      allowPrioritySupport: data.allowPrioritySupport ?? false,\n      enforcementConfig: data.enforcementConfig || null,\n    },\n  })\n}\n\n/**\n * Update a plan (admin only)\n */\nexport async function updatePlan(planId: string, data: Partial<{\n  name: string\n  displayName: string\n  description: string | null\n  price: number\n  currency: string\n  interval: string\n  isActive: boolean\n  isPublic: boolean\n  maxProjects: number | null\n  maxDevices: number | null\n  maxMockEndpoints: number | null\n  maxApiEndpoints: number | null\n  maxApiRequests: number | null\n  maxLogs: number | null\n  maxSessions: number | null\n  maxCrashes: number | null\n  retentionDays: number | null\n  allowApiTracking: boolean\n  allowScreenTracking: boolean\n  allowCrashReporting: boolean\n  allowLogging: boolean\n  allowBusinessConfig: boolean\n  allowLocalization: boolean\n  allowCustomDomains: boolean\n  allowWebhooks: boolean\n  allowTeamMembers: boolean\n  allowPrioritySupport: boolean\n  features?: any\n  enforcementConfig?: any\n}>) {\n  // Filter out read-only fields that might be sent from frontend\n  const {\n    id,\n    createdAt,\n    updatedAt,\n    _count,\n    subscriptions,\n    ...updateData\n  } = data as any\n\n  return prisma.plan.update({\n    where: { id: planId },\n    data: {\n      ...updateData,\n      updatedAt: new Date(),\n    },\n  })\n}\n\n/**\n * Delete a plan (admin only)\n * Only allowed if no active subscriptions use this plan\n */\nexport async function deletePlan(planId: string) {\n  // Check if plan has active subscriptions\n  const subscriptionCount = await prisma.subscription.count({\n    where: {\n      planId,\n      status: 'active',\n    },\n  })\n\n  if (subscriptionCount > 0) {\n    throw new Error(`Cannot delete plan: ${subscriptionCount} active subscription(s) are using this plan`)\n  }\n\n  return prisma.plan.delete({\n    where: { id: planId },\n  })\n}\n\n/**\n * Change subscription plan (admin only)\n */\nexport async function changeSubscriptionPlan(\n  subscriptionId: string,\n  newPlanId: string,\n  adminUserId: string\n) {\n  const subscription = await prisma.subscription.findUnique({\n    where: { id: subscriptionId },\n    include: { plan: true },\n  })\n\n  if (!subscription) {\n    throw new Error('Subscription not found')\n  }\n\n  const plan = await prisma.plan.findUnique({\n    where: { id: newPlanId },\n  })\n\n  if (!plan) {\n    throw new Error('Plan not found')\n  }\n\n  return prisma.subscription.update({\n    where: { id: subscriptionId },\n    data: {\n      planId: newPlanId,\n      // Reset trial dates if moving to free plan\n      ...(plan.name === 'free' && {\n        trialStartDate: new Date(),\n        trialEndDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\n      }),\n      updatedAt: new Date(),\n    },\n  })\n}\n\n/**\n * Update subscription quotas (admin only)\n */\nexport async function updateSubscriptionQuotas(\n  subscriptionId: string,\n  quotas: Partial<{\n    quotaMaxProjects: number | null\n    quotaMaxDevices: number | null\n    quotaMaxMockEndpoints: number | null\n    quotaMaxApiEndpoints: number | null\n    quotaMaxApiRequests: number | null\n    quotaMaxLogs: number | null\n    quotaMaxSessions: number | null\n    quotaMaxCrashes: number | null\n    quotaMaxBusinessConfigKeys: number | null\n    quotaMaxLocalizationLanguages: number | null\n    quotaMaxLocalizationKeys: number | null\n  }>\n) {\n  return prisma.subscription.update({\n    where: { id: subscriptionId },\n    data: {\n      ...quotas,\n      updatedAt: new Date(),\n    },\n    include: {\n      plan: true,\n      user: {\n        select: {\n          id: true,\n          email: true,\n          name: true,\n        },\n      },\n    },\n  })\n}\n\n/**\n * Update subscription status (admin only)\n */\nexport async function updateSubscriptionStatus(\n  subscriptionId: string,\n  status: 'active' | 'expired' | 'cancelled' | 'suspended' | 'disabled',\n  adminUserId: string\n) {\n  const updateData: any = {\n    status,\n    updatedAt: new Date(),\n  }\n\n  if (status === 'disabled' || status === 'suspended') {\n    updateData.enabled = false\n    updateData.disabledBy = adminUserId\n    updateData.disabledAt = new Date()\n  } else if (status === 'active') {\n    updateData.enabled = true\n    updateData.enabledBy = adminUserId\n    updateData.enabledAt = new Date()\n  }\n\n  return prisma.subscription.update({\n    where: { id: subscriptionId },\n    data: updateData,\n  })\n}\n\n/**\n * Get subscription with full details (admin only)\n */\nexport async function getSubscriptionDetails(subscriptionId: string) {\n  return prisma.subscription.findUnique({\n    where: { id: subscriptionId },\n    include: {\n      user: {\n        select: {\n          id: true,\n          email: true,\n          name: true,\n          createdAt: true,\n        },\n      },\n      plan: true,\n      invoices: {\n        orderBy: {\n          createdAt: 'desc',\n        },\n        take: 10,\n      },\n    },\n  })\n}\n\n/**\n * Create subscription for a user (admin only)\n */\nexport async function createSubscriptionForUser(\n  userId: string,\n  planId: string,\n  adminUserId: string,\n  options?: {\n    promoCodeId?: string\n    discountPercent?: number\n    discountAmount?: number\n  }\n) {\n  // Check if user already has a subscription\n  const existingSubscription = await prisma.subscription.findUnique({\n    where: { userId },\n  })\n\n  if (existingSubscription) {\n    throw new Error('User already has a subscription. Use changeSubscriptionPlan instead.')\n  }\n\n  // Get plan\n  const plan = await prisma.plan.findUnique({\n    where: { id: planId },\n  })\n\n  if (!plan) {\n    throw new Error('Plan not found')\n  }\n\n  // Calculate discount\n  let discountPercent = options?.discountPercent || null\n  let discountAmount = options?.discountAmount || null\n  let discountedPrice = plan.price\n\n  // If promo code provided, validate and apply\n  if (options?.promoCodeId) {\n    const promoCode = await prisma.promoCode.findUnique({\n      where: { id: options.promoCodeId },\n    })\n\n    if (!promoCode) {\n      throw new Error('Promo code not found')\n    }\n\n    if (!promoCode.isActive) {\n      throw new Error('Promo code is not active')\n    }\n\n    const now = new Date()\n    if (now < promoCode.validFrom) {\n      throw new Error('Promo code is not yet valid')\n    }\n\n    if (promoCode.validUntil && now > promoCode.validUntil) {\n      throw new Error('Promo code has expired')\n    }\n\n    if (promoCode.maxUses !== null && promoCode.currentUses >= promoCode.maxUses) {\n      throw new Error('Promo code has reached maximum uses')\n    }\n\n    if (promoCode.applicablePlans.length > 0 && !promoCode.applicablePlans.includes(plan.name)) {\n      throw new Error('Promo code does not apply to this plan')\n    }\n\n    if (promoCode.minPlanPrice !== null && plan.price < promoCode.minPlanPrice) {\n      throw new Error('Promo code requires a higher plan price')\n    }\n\n    // Apply discount\n    if (promoCode.discountType === 'percent') {\n      discountPercent = promoCode.discountValue\n      discountedPrice = plan.price * (1 - promoCode.discountValue / 100)\n    } else {\n      discountAmount = promoCode.discountValue\n      discountedPrice = Math.max(0, plan.price - promoCode.discountValue)\n    }\n\n    // Increment usage\n    await prisma.promoCode.update({\n      where: { id: promoCode.id },\n      data: {\n        currentUses: {\n          increment: 1,\n        },\n      },\n    })\n  } else if (options?.discountPercent) {\n    // Direct percentage discount\n    discountedPrice = plan.price * (1 - options.discountPercent / 100)\n  } else if (options?.discountAmount) {\n    // Direct fixed discount\n    discountedPrice = Math.max(0, plan.price - options.discountAmount)\n  }\n\n  // Calculate trial dates\n  const trialStartDate = new Date()\n  const trialDays = plan.retentionDays || 30\n  const trialEndDate = new Date(trialStartDate)\n  trialEndDate.setDate(trialEndDate.getDate() + trialDays)\n\n  // Create subscription\n  return prisma.subscription.create({\n    data: {\n      userId,\n      planId,\n      status: 'active',\n      enabled: true,\n      trialStartDate,\n      trialEndDate,\n      currentPeriodStart: trialStartDate,\n      currentPeriodEnd: trialEndDate,\n      // Note: promoCodeId, discountPercent, discountAmount, discountedPrice fields don't exist in Subscription model\n      // Promo code and discount information should be stored in Invoice model or handled separately\n    },\n    include: {\n      user: {\n        select: {\n          id: true,\n          email: true,\n          name: true,\n        },\n      },\n      plan: true,\n    },\n  })\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 744, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/devbridge/src/app/api/admin/revenue/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { validateAdmin } from '@/lib/auth'\nimport { getRevenueStats } from '@/lib/admin'\n\n/**\n * GET /api/admin/revenue\n * Get revenue statistics (admin only)\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const admin = await validateAdmin(request)\n    if (!admin) {\n      return NextResponse.json({ error: 'Unauthorized - Admin access required' }, { status: 403 })\n    }\n\n    const revenue = await getRevenueStats()\n    return NextResponse.json({ revenue })\n  } catch (error) {\n    console.error('Get revenue error:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAMO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,QAAQ,MAAM,IAAA,qIAAa,EAAC;QAClC,IAAI,CAAC,OAAO;YACV,OAAO,iTAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuC,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,MAAM,UAAU,MAAM,IAAA,wIAAe;QACrC,OAAO,iTAAY,CAAC,IAAI,CAAC;YAAE;QAAQ;IACrC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,iTAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}