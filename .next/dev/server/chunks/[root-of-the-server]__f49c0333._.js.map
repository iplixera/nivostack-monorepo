{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/devbridge/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 89, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/devbridge/src/lib/auth.ts"],"sourcesContent":["import { NextRequest } from 'next/server'\nimport jwt from 'jsonwebtoken'\nimport bcrypt from 'bcryptjs'\nimport { prisma } from './prisma'\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'fallback-secret-change-me'\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, 12)\n}\n\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n  return bcrypt.compare(password, hashedPassword)\n}\n\nexport function generateToken(userId: string): string {\n  return jwt.sign({ userId }, JWT_SECRET, { expiresIn: '7d' })\n}\n\nexport function verifyToken(token: string): { userId: string } | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as { userId: string }\n  } catch {\n    return null\n  }\n}\n\nexport async function validateToken(request: NextRequest): Promise<string | null> {\n  const authHeader = request.headers.get('authorization')\n  if (!authHeader?.startsWith('Bearer ')) {\n    return null\n  }\n\n  const token = authHeader.slice(7)\n  const payload = verifyToken(token)\n  if (!payload) {\n    return null\n  }\n\n  return payload.userId\n}\n\nexport async function getAuthUser(request: NextRequest) {\n  const authHeader = request.headers.get('authorization')\n  if (!authHeader?.startsWith('Bearer ')) {\n    return null\n  }\n\n  const token = authHeader.slice(7)\n  const payload = verifyToken(token)\n  if (!payload) {\n    return null\n  }\n\n  const user = await prisma.user.findUnique({\n    where: { id: payload.userId },\n    select: { id: true, email: true, name: true, isAdmin: true }\n  })\n\n  return user\n}\n\n// Helper function to check if user is admin (for use with already-fetched user)\nexport function isAdminUser(user: { isAdmin?: boolean } | null): boolean {\n  return user?.isAdmin === true\n}\n\nexport async function getProjectByApiKey(apiKey: string) {\n  const project = await prisma.project.findUnique({\n    where: { apiKey }\n  })\n  return project\n}\n\nexport async function validateApiKey(request: NextRequest) {\n  const apiKey = request.headers.get('x-api-key')\n  if (!apiKey) {\n    return null\n  }\n  return getProjectByApiKey(apiKey)\n}\n\nexport async function validateAdmin(request: NextRequest) {\n  const authHeader = request.headers.get('authorization')\n  if (!authHeader?.startsWith('Bearer ')) {\n    return null\n  }\n\n  const token = authHeader.slice(7)\n  const payload = verifyToken(token)\n  if (!payload) {\n    return null\n  }\n\n  const user = await prisma.user.findUnique({\n    where: { id: payload.userId },\n    select: { id: true, email: true, name: true, isAdmin: true }\n  })\n\n  if (!user || !user.isAdmin) {\n    return null\n  }\n\n  return user\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AACA;AACA;AACA;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,eAAe,aAAa,QAAgB;IACjD,OAAO,mMAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,eAAe,QAAgB,EAAE,cAAsB;IAC3E,OAAO,mMAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,SAAS,cAAc,MAAc;IAC1C,OAAO,2MAAG,CAAC,IAAI,CAAC;QAAE;IAAO,GAAG,YAAY;QAAE,WAAW;IAAK;AAC5D;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,2MAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,cAAc,OAAoB;IACtD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,OAAO,QAAQ,MAAM;AACvB;AAEO,eAAe,YAAY,OAAoB;IACpD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;QAC5B,QAAQ;YAAE,IAAI;YAAM,OAAO;YAAM,MAAM;YAAM,SAAS;QAAK;IAC7D;IAEA,OAAO;AACT;AAGO,SAAS,YAAY,IAAkC;IAC5D,OAAO,MAAM,YAAY;AAC3B;AAEO,eAAe,mBAAmB,MAAc;IACrD,MAAM,UAAU,MAAM,gIAAM,CAAC,OAAO,CAAC,UAAU,CAAC;QAC9C,OAAO;YAAE;QAAO;IAClB;IACA,OAAO;AACT;AAEO,eAAe,eAAe,OAAoB;IACvD,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;IACnC,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IACA,OAAO,mBAAmB;AAC5B;AAEO,eAAe,cAAc,OAAoB;IACtD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;QAC5B,QAAQ;YAAE,IAAI;YAAM,OAAO;YAAM,MAAM;YAAM,SAAS;QAAK;IAC7D;IAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,OAAO,EAAE;QAC1B,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 221, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/devbridge/src/app/api/localization/statistics/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport { verifyToken } from '@/lib/auth'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const projectId = request.nextUrl.searchParams.get('projectId')\n\n    if (!projectId) {\n      return NextResponse.json({ error: 'Missing projectId' }, { status: 400 })\n    }\n\n    // Authentication\n    const authHeader = request.headers.get('authorization')\n    if (!authHeader) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const token = authHeader.replace('Bearer ', '')\n    const payload = verifyToken(token)\n\n    if (!payload) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    // Verify project ownership\n    const project = await prisma.project.findFirst({\n      where: { id: projectId, userId: payload.userId },\n    })\n\n    if (!project) {\n      return NextResponse.json({ error: 'Project not found' }, { status: 404 })\n    }\n\n    // Get all keys\n    const totalKeys = await prisma.localizationKey.count({\n      where: { projectId },\n    })\n\n    // Get all languages\n    const languages = await prisma.language.findMany({\n      where: { projectId },\n      include: {\n        translations: {\n          select: {\n            id: true,\n            isReviewed: true,\n          },\n        },\n      },\n    })\n\n    const totalLanguages = languages.length\n\n    // Calculate statistics per language\n    const languageStats = await Promise.all(\n      languages.map(async (lang) => {\n        const totalTranslations = await prisma.translation.count({\n          where: {\n            projectId,\n            languageId: lang.id,\n          },\n        })\n\n        const reviewedCount = await prisma.translation.count({\n          where: {\n            projectId,\n            languageId: lang.id,\n            isReviewed: true,\n          },\n        })\n\n        const completionRate = totalKeys > 0 ? (totalTranslations / totalKeys) * 100 : 0\n        const reviewedRate = totalTranslations > 0 ? (reviewedCount / totalTranslations) * 100 : 0\n\n        return {\n          id: lang.id,\n          code: lang.code,\n          name: lang.name,\n          totalKeys,\n          translatedKeys: totalTranslations,\n          completionRate: Math.round(completionRate * 100) / 100,\n          missingKeys: totalKeys - totalTranslations,\n          reviewedCount,\n          reviewedRate: Math.round(reviewedRate * 100) / 100,\n        }\n      })\n    )\n\n    // Calculate overall completion rate\n    const totalTranslations = await prisma.translation.count({\n      where: { projectId },\n    })\n\n    const overallCompletionRate =\n      totalLanguages > 0 && totalKeys > 0\n        ? (totalTranslations / (totalKeys * totalLanguages)) * 100\n        : 0\n\n    // Get category statistics\n    const keysByCategory = await prisma.localizationKey.groupBy({\n      by: ['category'],\n      where: { projectId },\n      _count: {\n        id: true,\n      },\n    })\n\n    const categoryStats = await Promise.all(\n      keysByCategory.map(async (cat) => {\n        const categoryKeys = await prisma.localizationKey.findMany({\n          where: {\n            projectId,\n            category: cat.category,\n          },\n          select: { id: true },\n        })\n\n        const keyIds = categoryKeys.map((k) => k.id)\n        const translatedCount = await prisma.translation.count({\n          where: {\n            projectId,\n            keyId: { in: keyIds },\n          },\n        })\n\n        const completionRate = cat._count.id > 0 ? (translatedCount / (cat._count.id * totalLanguages)) * 100 : 0\n\n        return {\n          category: cat.category || 'Uncategorized',\n          totalKeys: cat._count.id,\n          translatedKeys: translatedCount,\n          completionRate: Math.round(completionRate * 100) / 100,\n        }\n      })\n    )\n\n    // Get recent activity (last 50 activities)\n    // Note: This is a simplified version. In production, you might want a dedicated Activity model\n    const recentKeys = await prisma.localizationKey.findMany({\n      where: { projectId },\n      orderBy: { updatedAt: 'desc' },\n      take: 20,\n      select: {\n        id: true,\n        key: true,\n        updatedAt: true,\n        createdAt: true,\n      },\n    })\n\n    const recentTranslations = await prisma.translation.findMany({\n      where: { projectId },\n      orderBy: { updatedAt: 'desc' },\n      take: 30,\n      select: {\n        id: true,\n        key: {\n          select: {\n            key: true,\n          },\n        },\n        language: {\n          select: {\n            code: true,\n            name: true,\n          },\n        },\n        updatedAt: true,\n        createdAt: true,\n      },\n    })\n\n    const recentActivity: Array<{\n      type: string\n      timestamp: string\n      details: Record<string, any>\n    }> = []\n\n    // Add key creation activities\n    for (const key of recentKeys) {\n      if (key.createdAt.getTime() === key.updatedAt.getTime()) {\n        recentActivity.push({\n          type: 'key_created',\n          timestamp: key.createdAt.toISOString(),\n          details: {\n            key: key.key,\n          },\n        })\n      }\n    }\n\n    // Add translation activities\n    for (const trans of recentTranslations) {\n      const isNew = trans.createdAt.getTime() === trans.updatedAt.getTime()\n      recentActivity.push({\n        type: isNew ? 'translation_created' : 'translation_updated',\n        timestamp: trans.updatedAt.toISOString(),\n        details: {\n          key: trans.key.key,\n          language: trans.language.code,\n          languageName: trans.language.name,\n        },\n      })\n    }\n\n    // Sort by timestamp and limit\n    recentActivity.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())\n    recentActivity.splice(50) // Keep only last 50\n\n    return NextResponse.json({\n      overview: {\n        totalKeys,\n        totalLanguages,\n        totalTranslations,\n        completionRate: Math.round(overallCompletionRate * 100) / 100,\n      },\n      languages: languageStats,\n      categories: categoryStats,\n      recentActivity,\n    })\n  } catch (error) {\n    console.error('Statistics error:', error)\n    return NextResponse.json(\n      { error: 'Internal server error', details: error instanceof Error ? error.message : 'Unknown error' },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,YAAY,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;QAEnD,IAAI,CAAC,WAAW;YACd,OAAO,iTAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,iBAAiB;QACjB,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,IAAI,CAAC,YAAY;YACf,OAAO,iTAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,QAAQ,WAAW,OAAO,CAAC,WAAW;QAC5C,MAAM,UAAU,IAAA,mIAAW,EAAC;QAE5B,IAAI,CAAC,SAAS;YACZ,OAAO,iTAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,2BAA2B;QAC3B,MAAM,UAAU,MAAM,gIAAM,CAAC,OAAO,CAAC,SAAS,CAAC;YAC7C,OAAO;gBAAE,IAAI;gBAAW,QAAQ,QAAQ,MAAM;YAAC;QACjD;QAEA,IAAI,CAAC,SAAS;YACZ,OAAO,iTAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,eAAe;QACf,MAAM,YAAY,MAAM,gIAAM,CAAC,eAAe,CAAC,KAAK,CAAC;YACnD,OAAO;gBAAE;YAAU;QACrB;QAEA,oBAAoB;QACpB,MAAM,YAAY,MAAM,gIAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;YAC/C,OAAO;gBAAE;YAAU;YACnB,SAAS;gBACP,cAAc;oBACZ,QAAQ;wBACN,IAAI;wBACJ,YAAY;oBACd;gBACF;YACF;QACF;QAEA,MAAM,iBAAiB,UAAU,MAAM;QAEvC,oCAAoC;QACpC,MAAM,gBAAgB,MAAM,QAAQ,GAAG,CACrC,UAAU,GAAG,CAAC,OAAO;YACnB,MAAM,oBAAoB,MAAM,gIAAM,CAAC,WAAW,CAAC,KAAK,CAAC;gBACvD,OAAO;oBACL;oBACA,YAAY,KAAK,EAAE;gBACrB;YACF;YAEA,MAAM,gBAAgB,MAAM,gIAAM,CAAC,WAAW,CAAC,KAAK,CAAC;gBACnD,OAAO;oBACL;oBACA,YAAY,KAAK,EAAE;oBACnB,YAAY;gBACd;YACF;YAEA,MAAM,iBAAiB,YAAY,IAAI,AAAC,oBAAoB,YAAa,MAAM;YAC/E,MAAM,eAAe,oBAAoB,IAAI,AAAC,gBAAgB,oBAAqB,MAAM;YAEzF,OAAO;gBACL,IAAI,KAAK,EAAE;gBACX,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,IAAI;gBACf;gBACA,gBAAgB;gBAChB,gBAAgB,KAAK,KAAK,CAAC,iBAAiB,OAAO;gBACnD,aAAa,YAAY;gBACzB;gBACA,cAAc,KAAK,KAAK,CAAC,eAAe,OAAO;YACjD;QACF;QAGF,oCAAoC;QACpC,MAAM,oBAAoB,MAAM,gIAAM,CAAC,WAAW,CAAC,KAAK,CAAC;YACvD,OAAO;gBAAE;YAAU;QACrB;QAEA,MAAM,wBACJ,iBAAiB,KAAK,YAAY,IAC9B,AAAC,oBAAoB,CAAC,YAAY,cAAc,IAAK,MACrD;QAEN,0BAA0B;QAC1B,MAAM,iBAAiB,MAAM,gIAAM,CAAC,eAAe,CAAC,OAAO,CAAC;YAC1D,IAAI;gBAAC;aAAW;YAChB,OAAO;gBAAE;YAAU;YACnB,QAAQ;gBACN,IAAI;YACN;QACF;QAEA,MAAM,gBAAgB,MAAM,QAAQ,GAAG,CACrC,eAAe,GAAG,CAAC,OAAO;YACxB,MAAM,eAAe,MAAM,gIAAM,CAAC,eAAe,CAAC,QAAQ,CAAC;gBACzD,OAAO;oBACL;oBACA,UAAU,IAAI,QAAQ;gBACxB;gBACA,QAAQ;oBAAE,IAAI;gBAAK;YACrB;YAEA,MAAM,SAAS,aAAa,GAAG,CAAC,CAAC,IAAM,EAAE,EAAE;YAC3C,MAAM,kBAAkB,MAAM,gIAAM,CAAC,WAAW,CAAC,KAAK,CAAC;gBACrD,OAAO;oBACL;oBACA,OAAO;wBAAE,IAAI;oBAAO;gBACtB;YACF;YAEA,MAAM,iBAAiB,IAAI,MAAM,CAAC,EAAE,GAAG,IAAI,AAAC,kBAAkB,CAAC,IAAI,MAAM,CAAC,EAAE,GAAG,cAAc,IAAK,MAAM;YAExG,OAAO;gBACL,UAAU,IAAI,QAAQ,IAAI;gBAC1B,WAAW,IAAI,MAAM,CAAC,EAAE;gBACxB,gBAAgB;gBAChB,gBAAgB,KAAK,KAAK,CAAC,iBAAiB,OAAO;YACrD;QACF;QAGF,2CAA2C;QAC3C,+FAA+F;QAC/F,MAAM,aAAa,MAAM,gIAAM,CAAC,eAAe,CAAC,QAAQ,CAAC;YACvD,OAAO;gBAAE;YAAU;YACnB,SAAS;gBAAE,WAAW;YAAO;YAC7B,MAAM;YACN,QAAQ;gBACN,IAAI;gBACJ,KAAK;gBACL,WAAW;gBACX,WAAW;YACb;QACF;QAEA,MAAM,qBAAqB,MAAM,gIAAM,CAAC,WAAW,CAAC,QAAQ,CAAC;YAC3D,OAAO;gBAAE;YAAU;YACnB,SAAS;gBAAE,WAAW;YAAO;YAC7B,MAAM;YACN,QAAQ;gBACN,IAAI;gBACJ,KAAK;oBACH,QAAQ;wBACN,KAAK;oBACP;gBACF;gBACA,UAAU;oBACR,QAAQ;wBACN,MAAM;wBACN,MAAM;oBACR;gBACF;gBACA,WAAW;gBACX,WAAW;YACb;QACF;QAEA,MAAM,iBAID,EAAE;QAEP,8BAA8B;QAC9B,KAAK,MAAM,OAAO,WAAY;YAC5B,IAAI,IAAI,SAAS,CAAC,OAAO,OAAO,IAAI,SAAS,CAAC,OAAO,IAAI;gBACvD,eAAe,IAAI,CAAC;oBAClB,MAAM;oBACN,WAAW,IAAI,SAAS,CAAC,WAAW;oBACpC,SAAS;wBACP,KAAK,IAAI,GAAG;oBACd;gBACF;YACF;QACF;QAEA,6BAA6B;QAC7B,KAAK,MAAM,SAAS,mBAAoB;YACtC,MAAM,QAAQ,MAAM,SAAS,CAAC,OAAO,OAAO,MAAM,SAAS,CAAC,OAAO;YACnE,eAAe,IAAI,CAAC;gBAClB,MAAM,QAAQ,wBAAwB;gBACtC,WAAW,MAAM,SAAS,CAAC,WAAW;gBACtC,SAAS;oBACP,KAAK,MAAM,GAAG,CAAC,GAAG;oBAClB,UAAU,MAAM,QAAQ,CAAC,IAAI;oBAC7B,cAAc,MAAM,QAAQ,CAAC,IAAI;gBACnC;YACF;QACF;QAEA,8BAA8B;QAC9B,eAAe,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;QAC7F,eAAe,MAAM,CAAC,KAAI,oBAAoB;QAE9C,OAAO,iTAAY,CAAC,IAAI,CAAC;YACvB,UAAU;gBACR;gBACA;gBACA;gBACA,gBAAgB,KAAK,KAAK,CAAC,wBAAwB,OAAO;YAC5D;YACA,WAAW;YACX,YAAY;YACZ;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,iTAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAyB,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAgB,GACpG;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}