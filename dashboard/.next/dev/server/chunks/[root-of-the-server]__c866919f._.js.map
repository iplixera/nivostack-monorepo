{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/nivostack-monorepo-checkout/dashboard/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\n/**\n * Primary Prisma Client (Read/Write)\n * \n * Use this client for all write operations and when read replica is not needed.\n * This connects to the primary database.\n */\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient({\n  log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n})\n\nif (process.env.NODE_ENV !== 'production') {\n  globalForPrisma.prisma = prisma\n  \n  // In development, ensure Prisma client is properly initialized\n  if (typeof prisma.user === 'undefined') {\n    console.warn('⚠️  Prisma client models not available. Restart dev server after running: pnpm prisma generate')\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA;;;;;CAKC,GAED,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY,CAAC;IAC/D,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEA,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;IAEzB,+DAA+D;IAC/D,IAAI,OAAO,OAAO,IAAI,KAAK,aAAa;QACtC,QAAQ,IAAI,CAAC;IACf;AACF"}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/nivostack-monorepo-checkout/dashboard/src/lib/auth.ts"],"sourcesContent":["import { NextRequest } from 'next/server'\nimport jwt from 'jsonwebtoken'\nimport bcrypt from 'bcryptjs'\nimport { prisma } from './prisma'\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'fallback-secret-change-me'\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, 12)\n}\n\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n  return bcrypt.compare(password, hashedPassword)\n}\n\nexport function generateToken(userId: string): string {\n  return jwt.sign({ userId }, JWT_SECRET, { expiresIn: '7d' })\n}\n\nexport function verifyToken(token: string): { userId: string } | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as { userId: string }\n  } catch {\n    return null\n  }\n}\n\nexport async function validateToken(request: NextRequest): Promise<string | null> {\n  const authHeader = request.headers.get('authorization')\n  if (!authHeader?.startsWith('Bearer ')) {\n    return null\n  }\n\n  const token = authHeader.slice(7)\n  const payload = verifyToken(token)\n  if (!payload) {\n    return null\n  }\n\n  return payload.userId\n}\n\nexport async function getAuthUser(request: NextRequest) {\n  const authHeader = request.headers.get('authorization')\n  if (!authHeader?.startsWith('Bearer ')) {\n    return null\n  }\n\n  const token = authHeader.slice(7)\n  const payload = verifyToken(token)\n  if (!payload) {\n    return null\n  }\n\n  const user = await prisma.user.findUnique({\n    where: { id: payload.userId },\n    select: { id: true, email: true, name: true, isAdmin: true }\n  })\n\n  return user\n}\n\n// Helper function to check if user is admin (for use with already-fetched user)\nexport function isAdminUser(user: { isAdmin?: boolean } | null): boolean {\n  return user?.isAdmin === true\n}\n\nexport async function getProjectByApiKey(apiKey: string) {\n  const project = await prisma.project.findUnique({\n    where: { apiKey }\n  })\n  return project\n}\n\nexport async function validateApiKey(request: NextRequest) {\n  const apiKey = request.headers.get('x-api-key')\n  if (!apiKey) {\n    return null\n  }\n  return getProjectByApiKey(apiKey)\n}\n\nexport async function validateAdmin(request: NextRequest) {\n  const authHeader = request.headers.get('authorization')\n  if (!authHeader?.startsWith('Bearer ')) {\n    return null\n  }\n\n  const token = authHeader.slice(7)\n  const payload = verifyToken(token)\n  if (!payload) {\n    return null\n  }\n\n  const user = await prisma.user.findUnique({\n    where: { id: payload.userId },\n    select: { id: true, email: true, name: true, isAdmin: true }\n  })\n\n  if (!user || !user.isAdmin) {\n    return null\n  }\n\n  return user\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AACA;AACA;AACA;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,eAAe,aAAa,QAAgB;IACjD,OAAO,mMAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,eAAe,QAAgB,EAAE,cAAsB;IAC3E,OAAO,mMAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,SAAS,cAAc,MAAc;IAC1C,OAAO,2MAAG,CAAC,IAAI,CAAC;QAAE;IAAO,GAAG,YAAY;QAAE,WAAW;IAAK;AAC5D;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,2MAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,cAAc,OAAoB;IACtD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,OAAO,QAAQ,MAAM;AACvB;AAEO,eAAe,YAAY,OAAoB;IACpD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,MAAM,OAAO,MAAM,6IAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;QAC5B,QAAQ;YAAE,IAAI;YAAM,OAAO;YAAM,MAAM;YAAM,SAAS;QAAK;IAC7D;IAEA,OAAO;AACT;AAGO,SAAS,YAAY,IAAkC;IAC5D,OAAO,MAAM,YAAY;AAC3B;AAEO,eAAe,mBAAmB,MAAc;IACrD,MAAM,UAAU,MAAM,6IAAM,CAAC,OAAO,CAAC,UAAU,CAAC;QAC9C,OAAO;YAAE;QAAO;IAClB;IACA,OAAO;AACT;AAEO,eAAe,eAAe,OAAoB;IACvD,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;IACnC,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IACA,OAAO,mBAAmB;AAC5B;AAEO,eAAe,cAAc,OAAoB;IACtD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IAEA,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,MAAM,OAAO,MAAM,6IAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;QAC5B,QAAQ;YAAE,IAAI;YAAM,OAAO;YAAM,MAAM;YAAM,SAAS;QAAK;IAC7D;IAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,OAAO,EAAE;QAC1B,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 238, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/nivostack-monorepo-checkout/dashboard/src/lib/notifications.ts"],"sourcesContent":["/**\n * Notification Utilities\n * \n * Helper functions for creating and managing user notifications\n */\n\nimport { prisma } from './prisma'\n\nexport type NotificationType = 'invitation' | 'project_update' | 'alert' | 'system'\n\nexport interface CreateNotificationParams {\n  userId: string\n  type: NotificationType\n  title: string\n  message: string\n  data?: Record<string, any>\n  actionUrl?: string\n}\n\n/**\n * Create a notification for a user\n */\nexport async function createNotification(params: CreateNotificationParams) {\n  return await prisma.userNotification.create({\n    data: {\n      userId: params.userId,\n      type: params.type,\n      title: params.title,\n      message: params.message,\n      data: params.data || null,\n      actionUrl: params.actionUrl || null,\n    },\n  })\n}\n\n/**\n * Create invitation notification\n */\nexport async function createInvitationNotification(\n  userId: string,\n  projectId: string,\n  invitationId: string,\n  projectName: string,\n  inviterName: string,\n  role: string,\n  invitationToken?: string\n) {\n  return await createNotification({\n    userId,\n    type: 'invitation',\n    title: `You've been invited to join ${projectName}`,\n    message: `${inviterName} has invited you to join the \"${projectName}\" project as a ${role}.`,\n    data: {\n      projectId,\n      invitationId,\n      role,\n      token: invitationToken, // Include token for direct acceptance\n    },\n    actionUrl: `/team?project=${projectId}`, // Link to team page where they can accept\n  })\n}\n\n/**\n * Mark notification as read\n */\nexport async function markNotificationAsRead(notificationId: string, userId: string) {\n  return await prisma.userNotification.updateMany({\n    where: {\n      id: notificationId,\n      userId, // Ensure user owns the notification\n    },\n    data: {\n      read: true,\n      readAt: new Date(),\n    },\n  })\n}\n\n/**\n * Mark all notifications as read for a user\n */\nexport async function markAllNotificationsAsRead(userId: string) {\n  return await prisma.userNotification.updateMany({\n    where: {\n      userId,\n      read: false,\n    },\n    data: {\n      read: true,\n      readAt: new Date(),\n    },\n  })\n}\n\n/**\n * Get user's unread notification count\n */\nexport async function getUnreadNotificationCount(userId: string): Promise<number> {\n  return await prisma.userNotification.count({\n    where: {\n      userId,\n      read: false,\n    },\n  })\n}\n\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;;;;;;AAED;;AAgBO,eAAe,mBAAmB,MAAgC;IACvE,OAAO,MAAM,6IAAM,CAAC,gBAAgB,CAAC,MAAM,CAAC;QAC1C,MAAM;YACJ,QAAQ,OAAO,MAAM;YACrB,MAAM,OAAO,IAAI;YACjB,OAAO,OAAO,KAAK;YACnB,SAAS,OAAO,OAAO;YACvB,MAAM,OAAO,IAAI,IAAI;YACrB,WAAW,OAAO,SAAS,IAAI;QACjC;IACF;AACF;AAKO,eAAe,6BACpB,MAAc,EACd,SAAiB,EACjB,YAAoB,EACpB,WAAmB,EACnB,WAAmB,EACnB,IAAY,EACZ,eAAwB;IAExB,OAAO,MAAM,mBAAmB;QAC9B;QACA,MAAM;QACN,OAAO,CAAC,4BAA4B,EAAE,aAAa;QACnD,SAAS,GAAG,YAAY,8BAA8B,EAAE,YAAY,eAAe,EAAE,KAAK,CAAC,CAAC;QAC5F,MAAM;YACJ;YACA;YACA;YACA,OAAO;QACT;QACA,WAAW,CAAC,cAAc,EAAE,WAAW;IACzC;AACF;AAKO,eAAe,uBAAuB,cAAsB,EAAE,MAAc;IACjF,OAAO,MAAM,6IAAM,CAAC,gBAAgB,CAAC,UAAU,CAAC;QAC9C,OAAO;YACL,IAAI;YACJ;QACF;QACA,MAAM;YACJ,MAAM;YACN,QAAQ,IAAI;QACd;IACF;AACF;AAKO,eAAe,2BAA2B,MAAc;IAC7D,OAAO,MAAM,6IAAM,CAAC,gBAAgB,CAAC,UAAU,CAAC;QAC9C,OAAO;YACL;YACA,MAAM;QACR;QACA,MAAM;YACJ,MAAM;YACN,QAAQ,IAAI;QACd;IACF;AACF;AAKO,eAAe,2BAA2B,MAAc;IAC7D,OAAO,MAAM,6IAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC;QACzC,OAAO;YACL;YACA,MAAM;QACR;IACF;AACF"}},
    {"offset": {"line": 319, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/nivostack-monorepo-checkout/dashboard/src/app/api/notifications/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport { getAuthUser } from '@/lib/auth'\nimport { getUnreadNotificationCount } from '@/lib/notifications'\n\n/**\n * GET /api/notifications\n * Get user's notifications\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const user = await getAuthUser(request)\n    if (!user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { searchParams } = new URL(request.url)\n    const limit = parseInt(searchParams.get('limit') || '50', 10)\n    const unreadOnly = searchParams.get('unreadOnly') === 'true'\n\n    const where: any = {\n      userId: user.id,\n    }\n\n    if (unreadOnly) {\n      where.read = false\n    }\n\n    const notifications = await prisma.userNotification.findMany({\n      where,\n      orderBy: { createdAt: 'desc' },\n      take: limit,\n    })\n\n    const unreadCount = await getUnreadNotificationCount(user.id)\n\n    return NextResponse.json({\n      notifications: notifications.map((notif) => ({\n        id: notif.id,\n        type: notif.type,\n        title: notif.title,\n        message: notif.message,\n        data: notif.data,\n        read: notif.read,\n        readAt: notif.readAt?.toISOString() || null,\n        actionUrl: notif.actionUrl,\n        createdAt: notif.createdAt.toISOString(),\n      })),\n      unreadCount,\n    })\n  } catch (error) {\n    console.error('Get notifications error:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAMO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,gJAAW,EAAC;QAC/B,IAAI,CAAC,MAAM;YACT,OAAO,iTAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY,MAAM;QAC1D,MAAM,aAAa,aAAa,GAAG,CAAC,kBAAkB;QAEtD,MAAM,QAAa;YACjB,QAAQ,KAAK,EAAE;QACjB;QAEA,IAAI,YAAY;YACd,MAAM,IAAI,GAAG;QACf;QAEA,MAAM,gBAAgB,MAAM,6IAAM,CAAC,gBAAgB,CAAC,QAAQ,CAAC;YAC3D;YACA,SAAS;gBAAE,WAAW;YAAO;YAC7B,MAAM;QACR;QAEA,MAAM,cAAc,MAAM,IAAA,wKAA0B,EAAC,KAAK,EAAE;QAE5D,OAAO,iTAAY,CAAC,IAAI,CAAC;YACvB,eAAe,cAAc,GAAG,CAAC,CAAC,QAAU,CAAC;oBAC3C,IAAI,MAAM,EAAE;oBACZ,MAAM,MAAM,IAAI;oBAChB,OAAO,MAAM,KAAK;oBAClB,SAAS,MAAM,OAAO;oBACtB,MAAM,MAAM,IAAI;oBAChB,MAAM,MAAM,IAAI;oBAChB,QAAQ,MAAM,MAAM,EAAE,iBAAiB;oBACvC,WAAW,MAAM,SAAS;oBAC1B,WAAW,MAAM,SAAS,CAAC,WAAW;gBACxC,CAAC;YACD;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,iTAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}