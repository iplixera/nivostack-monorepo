{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/nivostack-monorepo-checkout/dashboard/src/lib/subscription-analytics.ts"],"sourcesContent":["import { prisma } from './prisma'\nimport { getUsageStats } from './subscription'\n\nexport type UsageSegment = 'low' | 'medium' | 'high' | 'exceeded'\nexport type PlanDistribution = {\n  planName: string\n  planDisplayName: string\n  count: number\n  percentage: number\n  totalRevenue: number\n}\n\nexport type UsageSegmentStats = {\n  segment: UsageSegment\n  label: string\n  count: number\n  percentage: number\n  users: Array<{\n    userId: string\n    email: string\n    planName: string\n    usagePercentage: number\n    meters: Record<string, { used: number; limit: number | null; percentage: number }>\n  }>\n}\n\nexport type SubscriptionAnalytics = {\n  planDistribution: PlanDistribution[]\n  usageSegmentation: {\n    devices: UsageSegmentStats[]\n    apiRequests: UsageSegmentStats[]\n    logs: UsageSegmentStats[]\n    sessions: UsageSegmentStats[]\n  }\n  atRiskUsers: Array<{\n    userId: string\n    email: string\n    planName: string\n    highestUsage: { meter: string; percentage: number }\n    allMeters: Record<string, { used: number; limit: number | null; percentage: number }>\n  }>\n  atLimitUsers: Array<{\n    userId: string\n    email: string\n    planName: string\n    exceededMeters: string[]\n    allMeters: Record<string, { used: number; limit: number | null; percentage: number }>\n  }>\n  conversionOpportunities: Array<{\n    userId: string\n    email: string\n    currentPlan: string\n    recommendedPlan: string\n    reason: string\n    usagePercentage: number\n  }>\n  summary: {\n    totalUsers: number\n    totalActiveSubscriptions: number\n    averageUsagePercentage: number\n    usersAtRisk: number\n    usersAtLimit: number\n    conversionOpportunities: number\n  }\n}\n\n/**\n * Get subscription analytics with usage segmentation\n */\nexport async function getSubscriptionAnalytics(): Promise<SubscriptionAnalytics> {\n  // Get all active subscriptions with users and plans\n  const subscriptions = await prisma.subscription.findMany({\n    where: {\n      status: 'active',\n      enabled: true,\n    },\n    include: {\n      user: {\n        select: {\n          id: true,\n          email: true,\n          name: true,\n        },\n      },\n      plan: {\n        select: {\n          id: true,\n          name: true,\n          displayName: true,\n          price: true,\n        },\n      },\n    },\n  })\n\n  // Plan distribution\n  const planCounts: Record<string, { count: number; revenue: number }> = {}\n  subscriptions.forEach((sub) => {\n    const planName = sub.plan.name\n    if (!planCounts[planName]) {\n      planCounts[planName] = { count: 0, revenue: 0 }\n    }\n    planCounts[planName].count++\n    planCounts[planName].revenue += sub.plan.price\n  })\n\n  const totalSubscriptions = subscriptions.length\n  const planDistribution: PlanDistribution[] = Object.entries(planCounts).map(\n    ([planName, data]) => {\n      const plan = subscriptions.find((s) => s.plan.name === planName)?.plan\n      return {\n        planName,\n        planDisplayName: plan?.displayName || planName,\n        count: data.count,\n        percentage: totalSubscriptions > 0 ? (data.count / totalSubscriptions) * 100 : 0,\n        totalRevenue: data.revenue,\n      }\n    }\n  )\n\n  // Usage segmentation\n  const usageData: Array<{\n    userId: string\n    email: string\n    planName: string\n    usage: Awaited<ReturnType<typeof getUsageStats>>\n  }> = []\n\n  for (const sub of subscriptions) {\n    try {\n      const usage = await getUsageStats(sub.userId)\n      if (usage) {\n        usageData.push({\n          userId: sub.userId,\n          email: sub.user.email,\n          planName: sub.plan.name,\n          usage,\n        })\n      }\n    } catch (error) {\n      console.error(`Error getting usage for user ${sub.userId}:`, error)\n    }\n  }\n\n  // Segment users by usage percentage\n  function segmentByUsage(\n    meterKey: 'devices' | 'apiRequests' | 'logs' | 'sessions'\n  ): UsageSegmentStats[] {\n    const segments: Record<UsageSegment, typeof usageData> = {\n      low: [],\n      medium: [],\n      high: [],\n      exceeded: [],\n    }\n\n    usageData.forEach((data) => {\n      if (!data.usage) return\n      const meter = (data.usage as any)[meterKey]\n      if (!meter) return\n\n      const percentage = meter.percentage\n      let segment: UsageSegment\n\n      if (meter.limit === null) {\n        // Unlimited - consider as low usage\n        segment = 'low'\n      } else if (percentage >= 100) {\n        segment = 'exceeded'\n      } else if (percentage >= 80) {\n        segment = 'high'\n      } else if (percentage >= 50) {\n        segment = 'medium'\n      } else {\n        segment = 'low'\n      }\n\n      segments[segment].push(data)\n    })\n\n    return [\n      {\n        segment: 'low',\n        label: 'Low Usage (0-50%)',\n        count: segments.low.length,\n        percentage: usageData.length > 0 ? (segments.low.length / usageData.length) * 100 : 0,\n        users: segments.low.filter(d => d.usage).map((d) => ({\n          userId: d.userId,\n          email: d.email,\n          planName: d.planName,\n          usagePercentage: d.usage![meterKey]?.percentage || 0,\n          meters: {\n            devices: d.usage!.devices,\n            apiRequests: d.usage!.apiRequests,\n            logs: d.usage!.logs,\n            sessions: d.usage!.sessions,\n          },\n        })),\n      },\n      {\n        segment: 'medium',\n        label: 'Medium Usage (50-80%)',\n        count: segments.medium.length,\n        percentage: usageData.length > 0 ? (segments.medium.length / usageData.length) * 100 : 0,\n        users: segments.medium.filter(d => d.usage).map((d) => ({\n          userId: d.userId,\n          email: d.email,\n          planName: d.planName,\n          usagePercentage: d.usage![meterKey]?.percentage || 0,\n          meters: {\n            devices: d.usage!.devices,\n            apiRequests: d.usage!.apiRequests,\n            logs: d.usage!.logs,\n            sessions: d.usage!.sessions,\n          },\n        })),\n      },\n      {\n        segment: 'high',\n        label: 'High Usage (80-100%)',\n        count: segments.high.length,\n        percentage: usageData.length > 0 ? (segments.high.length / usageData.length) * 100 : 0,\n        users: segments.high.filter(d => d.usage).map((d) => ({\n          userId: d.userId,\n          email: d.email,\n          planName: d.planName,\n          usagePercentage: d.usage![meterKey]?.percentage || 0,\n          meters: {\n            devices: d.usage!.devices,\n            apiRequests: d.usage!.apiRequests,\n            logs: d.usage!.logs,\n            sessions: d.usage!.sessions,\n          },\n        })),\n      },\n      {\n        segment: 'exceeded',\n        label: 'Exceeded Limit (100%+)',\n        count: segments.exceeded.length,\n        percentage: usageData.length > 0 ? (segments.exceeded.length / usageData.length) * 100 : 0,\n        users: segments.exceeded.filter(d => d.usage).map((d) => ({\n          userId: d.userId,\n          email: d.email,\n          planName: d.planName,\n          usagePercentage: d.usage![meterKey]?.percentage || 0,\n          meters: {\n            devices: d.usage!.devices,\n            apiRequests: d.usage!.apiRequests,\n            logs: d.usage!.logs,\n            sessions: d.usage!.sessions,\n          },\n        })),\n      },\n    ]\n  }\n\n  // At-risk users (80%+ usage on any meter)\n  const atRiskUsers = usageData\n    .filter((d) => {\n      const meters = d.usage ? [d.usage.devices, d.usage.apiRequests, d.usage.logs, d.usage.sessions] : []\n      return meters.some((m) => m && m.limit !== null && m.percentage >= 80 && m.percentage < 100)\n    })\n    .filter(d => d.usage)\n    .map((d) => {\n      const meters = {\n        devices: d.usage!.devices,\n        apiRequests: d.usage!.apiRequests,\n        logs: d.usage!.logs,\n        sessions: d.usage!.sessions,\n      }\n      const highestUsage = Object.entries(meters)\n        .map(([key, meter]) => ({ meter: key, percentage: meter.percentage }))\n        .sort((a, b) => b.percentage - a.percentage)[0]\n\n      return {\n        userId: d.userId,\n        email: d.email,\n        planName: d.planName,\n        highestUsage,\n        allMeters: meters,\n      }\n    })\n    .sort((a, b) => b.highestUsage.percentage - a.highestUsage.percentage)\n\n  // At-limit users (100%+ usage on any meter)\n  const atLimitUsers = usageData\n    .filter((d) => {\n      const meters = d.usage ? [d.usage.devices, d.usage.apiRequests, d.usage.logs, d.usage.sessions] : []\n      return meters.some((m) => m && m.limit !== null && m.percentage >= 100)\n    })\n    .filter(d => d.usage)\n    .map((d) => {\n      const meters = {\n        devices: d.usage!.devices,\n        apiRequests: d.usage!.apiRequests,\n        logs: d.usage!.logs,\n        sessions: d.usage!.sessions,\n      }\n      const exceededMeters = Object.entries(meters)\n        .filter(([_, meter]) => meter.limit !== null && meter.percentage >= 100)\n        .map(([key]) => key)\n\n      return {\n        userId: d.userId,\n        email: d.email,\n        planName: d.planName,\n        exceededMeters,\n        allMeters: meters,\n      }\n    })\n\n  // Conversion opportunities (users on lower plans with high usage)\n  const conversionOpportunities: SubscriptionAnalytics['conversionOpportunities'] = []\n  const planHierarchy = ['free', 'pro', 'team', 'enterprise']\n  \n  usageData.forEach((d) => {\n    const currentPlanIndex = planHierarchy.indexOf(d.planName)\n    if (currentPlanIndex === -1 || currentPlanIndex === planHierarchy.length - 1 || !d.usage) return\n\n    const meters = [d.usage.devices, d.usage.apiRequests, d.usage.logs, d.usage.sessions]\n    const maxUsage = Math.max(...meters.map((m) => m?.percentage || 0))\n\n    if (maxUsage >= 80) {\n      const recommendedPlan = planHierarchy[currentPlanIndex + 1]\n      conversionOpportunities.push({\n        userId: d.userId,\n        email: d.email,\n        currentPlan: d.planName,\n        recommendedPlan,\n        reason: `Usage at ${maxUsage.toFixed(1)}% - Consider upgrading to ${recommendedPlan}`,\n        usagePercentage: maxUsage,\n      })\n    }\n  })\n\n  // Calculate summary\n  const totalUsagePercentages = usageData.filter(d => d.usage).map((d) => {\n    const meters = [d.usage!.devices, d.usage!.apiRequests, d.usage!.logs, d.usage!.sessions]\n    return Math.max(...meters.map((m) => m?.percentage || 0))\n  })\n  const averageUsagePercentage =\n    totalUsagePercentages.length > 0\n      ? totalUsagePercentages.reduce((a, b) => a + b, 0) / totalUsagePercentages.length\n      : 0\n\n  return {\n    planDistribution,\n    usageSegmentation: {\n      devices: segmentByUsage('devices'),\n      apiRequests: segmentByUsage('apiRequests'),\n      logs: segmentByUsage('logs'),\n      sessions: segmentByUsage('sessions'),\n    },\n    atRiskUsers,\n    atLimitUsers,\n    conversionOpportunities: conversionOpportunities.sort((a, b) => b.usagePercentage - a.usagePercentage),\n    summary: {\n      totalUsers: subscriptions.length,\n      totalActiveSubscriptions: subscriptions.length,\n      averageUsagePercentage,\n      usersAtRisk: atRiskUsers.length,\n      usersAtLimit: atLimitUsers.length,\n      conversionOpportunities: conversionOpportunities.length,\n    },\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAoEO,eAAe;IACpB,oDAAoD;IACpD,MAAM,gBAAgB,MAAM,6IAAM,CAAC,YAAY,CAAC,QAAQ,CAAC;QACvD,OAAO;YACL,QAAQ;YACR,SAAS;QACX;QACA,SAAS;YACP,MAAM;gBACJ,QAAQ;oBACN,IAAI;oBACJ,OAAO;oBACP,MAAM;gBACR;YACF;YACA,MAAM;gBACJ,QAAQ;oBACN,IAAI;oBACJ,MAAM;oBACN,aAAa;oBACb,OAAO;gBACT;YACF;QACF;IACF;IAEA,oBAAoB;IACpB,MAAM,aAAiE,CAAC;IACxE,cAAc,OAAO,CAAC,CAAC;QACrB,MAAM,WAAW,IAAI,IAAI,CAAC,IAAI;QAC9B,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE;YACzB,UAAU,CAAC,SAAS,GAAG;gBAAE,OAAO;gBAAG,SAAS;YAAE;QAChD;QACA,UAAU,CAAC,SAAS,CAAC,KAAK;QAC1B,UAAU,CAAC,SAAS,CAAC,OAAO,IAAI,IAAI,IAAI,CAAC,KAAK;IAChD;IAEA,MAAM,qBAAqB,cAAc,MAAM;IAC/C,MAAM,mBAAuC,OAAO,OAAO,CAAC,YAAY,GAAG,CACzE,CAAC,CAAC,UAAU,KAAK;QACf,MAAM,OAAO,cAAc,IAAI,CAAC,CAAC,IAAM,EAAE,IAAI,CAAC,IAAI,KAAK,WAAW;QAClE,OAAO;YACL;YACA,iBAAiB,MAAM,eAAe;YACtC,OAAO,KAAK,KAAK;YACjB,YAAY,qBAAqB,IAAI,AAAC,KAAK,KAAK,GAAG,qBAAsB,MAAM;YAC/E,cAAc,KAAK,OAAO;QAC5B;IACF;IAGF,qBAAqB;IACrB,MAAM,YAKD,EAAE;IAEP,KAAK,MAAM,OAAO,cAAe;QAC/B,IAAI;YACF,MAAM,QAAQ,MAAM,IAAA,0JAAa,EAAC,IAAI,MAAM;YAC5C,IAAI,OAAO;gBACT,UAAU,IAAI,CAAC;oBACb,QAAQ,IAAI,MAAM;oBAClB,OAAO,IAAI,IAAI,CAAC,KAAK;oBACrB,UAAU,IAAI,IAAI,CAAC,IAAI;oBACvB;gBACF;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,CAAC,6BAA6B,EAAE,IAAI,MAAM,CAAC,CAAC,CAAC,EAAE;QAC/D;IACF;IAEA,oCAAoC;IACpC,SAAS,eACP,QAAyD;QAEzD,MAAM,WAAmD;YACvD,KAAK,EAAE;YACP,QAAQ,EAAE;YACV,MAAM,EAAE;YACR,UAAU,EAAE;QACd;QAEA,UAAU,OAAO,CAAC,CAAC;YACjB,IAAI,CAAC,KAAK,KAAK,EAAE;YACjB,MAAM,QAAQ,AAAC,KAAK,KAAK,AAAQ,CAAC,SAAS;YAC3C,IAAI,CAAC,OAAO;YAEZ,MAAM,aAAa,MAAM,UAAU;YACnC,IAAI;YAEJ,IAAI,MAAM,KAAK,KAAK,MAAM;gBACxB,oCAAoC;gBACpC,UAAU;YACZ,OAAO,IAAI,cAAc,KAAK;gBAC5B,UAAU;YACZ,OAAO,IAAI,cAAc,IAAI;gBAC3B,UAAU;YACZ,OAAO,IAAI,cAAc,IAAI;gBAC3B,UAAU;YACZ,OAAO;gBACL,UAAU;YACZ;YAEA,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC;QACzB;QAEA,OAAO;YACL;gBACE,SAAS;gBACT,OAAO;gBACP,OAAO,SAAS,GAAG,CAAC,MAAM;gBAC1B,YAAY,UAAU,MAAM,GAAG,IAAI,AAAC,SAAS,GAAG,CAAC,MAAM,GAAG,UAAU,MAAM,GAAI,MAAM;gBACpF,OAAO,SAAS,GAAG,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC,IAAM,CAAC;wBACnD,QAAQ,EAAE,MAAM;wBAChB,OAAO,EAAE,KAAK;wBACd,UAAU,EAAE,QAAQ;wBACpB,iBAAiB,EAAE,KAAK,AAAC,CAAC,SAAS,EAAE,cAAc;wBACnD,QAAQ;4BACN,SAAS,EAAE,KAAK,CAAE,OAAO;4BACzB,aAAa,EAAE,KAAK,CAAE,WAAW;4BACjC,MAAM,EAAE,KAAK,CAAE,IAAI;4BACnB,UAAU,EAAE,KAAK,CAAE,QAAQ;wBAC7B;oBACF,CAAC;YACH;YACA;gBACE,SAAS;gBACT,OAAO;gBACP,OAAO,SAAS,MAAM,CAAC,MAAM;gBAC7B,YAAY,UAAU,MAAM,GAAG,IAAI,AAAC,SAAS,MAAM,CAAC,MAAM,GAAG,UAAU,MAAM,GAAI,MAAM;gBACvF,OAAO,SAAS,MAAM,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC,IAAM,CAAC;wBACtD,QAAQ,EAAE,MAAM;wBAChB,OAAO,EAAE,KAAK;wBACd,UAAU,EAAE,QAAQ;wBACpB,iBAAiB,EAAE,KAAK,AAAC,CAAC,SAAS,EAAE,cAAc;wBACnD,QAAQ;4BACN,SAAS,EAAE,KAAK,CAAE,OAAO;4BACzB,aAAa,EAAE,KAAK,CAAE,WAAW;4BACjC,MAAM,EAAE,KAAK,CAAE,IAAI;4BACnB,UAAU,EAAE,KAAK,CAAE,QAAQ;wBAC7B;oBACF,CAAC;YACH;YACA;gBACE,SAAS;gBACT,OAAO;gBACP,OAAO,SAAS,IAAI,CAAC,MAAM;gBAC3B,YAAY,UAAU,MAAM,GAAG,IAAI,AAAC,SAAS,IAAI,CAAC,MAAM,GAAG,UAAU,MAAM,GAAI,MAAM;gBACrF,OAAO,SAAS,IAAI,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC,IAAM,CAAC;wBACpD,QAAQ,EAAE,MAAM;wBAChB,OAAO,EAAE,KAAK;wBACd,UAAU,EAAE,QAAQ;wBACpB,iBAAiB,EAAE,KAAK,AAAC,CAAC,SAAS,EAAE,cAAc;wBACnD,QAAQ;4BACN,SAAS,EAAE,KAAK,CAAE,OAAO;4BACzB,aAAa,EAAE,KAAK,CAAE,WAAW;4BACjC,MAAM,EAAE,KAAK,CAAE,IAAI;4BACnB,UAAU,EAAE,KAAK,CAAE,QAAQ;wBAC7B;oBACF,CAAC;YACH;YACA;gBACE,SAAS;gBACT,OAAO;gBACP,OAAO,SAAS,QAAQ,CAAC,MAAM;gBAC/B,YAAY,UAAU,MAAM,GAAG,IAAI,AAAC,SAAS,QAAQ,CAAC,MAAM,GAAG,UAAU,MAAM,GAAI,MAAM;gBACzF,OAAO,SAAS,QAAQ,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC,IAAM,CAAC;wBACxD,QAAQ,EAAE,MAAM;wBAChB,OAAO,EAAE,KAAK;wBACd,UAAU,EAAE,QAAQ;wBACpB,iBAAiB,EAAE,KAAK,AAAC,CAAC,SAAS,EAAE,cAAc;wBACnD,QAAQ;4BACN,SAAS,EAAE,KAAK,CAAE,OAAO;4BACzB,aAAa,EAAE,KAAK,CAAE,WAAW;4BACjC,MAAM,EAAE,KAAK,CAAE,IAAI;4BACnB,UAAU,EAAE,KAAK,CAAE,QAAQ;wBAC7B;oBACF,CAAC;YACH;SACD;IACH;IAEA,0CAA0C;IAC1C,MAAM,cAAc,UACjB,MAAM,CAAC,CAAC;QACP,MAAM,SAAS,EAAE,KAAK,GAAG;YAAC,EAAE,KAAK,CAAC,OAAO;YAAE,EAAE,KAAK,CAAC,WAAW;YAAE,EAAE,KAAK,CAAC,IAAI;YAAE,EAAE,KAAK,CAAC,QAAQ;SAAC,GAAG,EAAE;QACpG,OAAO,OAAO,IAAI,CAAC,CAAC,IAAM,KAAK,EAAE,KAAK,KAAK,QAAQ,EAAE,UAAU,IAAI,MAAM,EAAE,UAAU,GAAG;IAC1F,GACC,MAAM,CAAC,CAAA,IAAK,EAAE,KAAK,EACnB,GAAG,CAAC,CAAC;QACJ,MAAM,SAAS;YACb,SAAS,EAAE,KAAK,CAAE,OAAO;YACzB,aAAa,EAAE,KAAK,CAAE,WAAW;YACjC,MAAM,EAAE,KAAK,CAAE,IAAI;YACnB,UAAU,EAAE,KAAK,CAAE,QAAQ;QAC7B;QACA,MAAM,eAAe,OAAO,OAAO,CAAC,QACjC,GAAG,CAAC,CAAC,CAAC,KAAK,MAAM,GAAK,CAAC;gBAAE,OAAO;gBAAK,YAAY,MAAM,UAAU;YAAC,CAAC,GACnE,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,UAAU,GAAG,EAAE,UAAU,CAAC,CAAC,EAAE;QAEjD,OAAO;YACL,QAAQ,EAAE,MAAM;YAChB,OAAO,EAAE,KAAK;YACd,UAAU,EAAE,QAAQ;YACpB;YACA,WAAW;QACb;IACF,GACC,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,YAAY,CAAC,UAAU,GAAG,EAAE,YAAY,CAAC,UAAU;IAEvE,4CAA4C;IAC5C,MAAM,eAAe,UAClB,MAAM,CAAC,CAAC;QACP,MAAM,SAAS,EAAE,KAAK,GAAG;YAAC,EAAE,KAAK,CAAC,OAAO;YAAE,EAAE,KAAK,CAAC,WAAW;YAAE,EAAE,KAAK,CAAC,IAAI;YAAE,EAAE,KAAK,CAAC,QAAQ;SAAC,GAAG,EAAE;QACpG,OAAO,OAAO,IAAI,CAAC,CAAC,IAAM,KAAK,EAAE,KAAK,KAAK,QAAQ,EAAE,UAAU,IAAI;IACrE,GACC,MAAM,CAAC,CAAA,IAAK,EAAE,KAAK,EACnB,GAAG,CAAC,CAAC;QACJ,MAAM,SAAS;YACb,SAAS,EAAE,KAAK,CAAE,OAAO;YACzB,aAAa,EAAE,KAAK,CAAE,WAAW;YACjC,MAAM,EAAE,KAAK,CAAE,IAAI;YACnB,UAAU,EAAE,KAAK,CAAE,QAAQ;QAC7B;QACA,MAAM,iBAAiB,OAAO,OAAO,CAAC,QACnC,MAAM,CAAC,CAAC,CAAC,GAAG,MAAM,GAAK,MAAM,KAAK,KAAK,QAAQ,MAAM,UAAU,IAAI,KACnE,GAAG,CAAC,CAAC,CAAC,IAAI,GAAK;QAElB,OAAO;YACL,QAAQ,EAAE,MAAM;YAChB,OAAO,EAAE,KAAK;YACd,UAAU,EAAE,QAAQ;YACpB;YACA,WAAW;QACb;IACF;IAEF,kEAAkE;IAClE,MAAM,0BAA4E,EAAE;IACpF,MAAM,gBAAgB;QAAC;QAAQ;QAAO;QAAQ;KAAa;IAE3D,UAAU,OAAO,CAAC,CAAC;QACjB,MAAM,mBAAmB,cAAc,OAAO,CAAC,EAAE,QAAQ;QACzD,IAAI,qBAAqB,CAAC,KAAK,qBAAqB,cAAc,MAAM,GAAG,KAAK,CAAC,EAAE,KAAK,EAAE;QAE1F,MAAM,SAAS;YAAC,EAAE,KAAK,CAAC,OAAO;YAAE,EAAE,KAAK,CAAC,WAAW;YAAE,EAAE,KAAK,CAAC,IAAI;YAAE,EAAE,KAAK,CAAC,QAAQ;SAAC;QACrF,MAAM,WAAW,KAAK,GAAG,IAAI,OAAO,GAAG,CAAC,CAAC,IAAM,GAAG,cAAc;QAEhE,IAAI,YAAY,IAAI;YAClB,MAAM,kBAAkB,aAAa,CAAC,mBAAmB,EAAE;YAC3D,wBAAwB,IAAI,CAAC;gBAC3B,QAAQ,EAAE,MAAM;gBAChB,OAAO,EAAE,KAAK;gBACd,aAAa,EAAE,QAAQ;gBACvB;gBACA,QAAQ,CAAC,SAAS,EAAE,SAAS,OAAO,CAAC,GAAG,0BAA0B,EAAE,iBAAiB;gBACrF,iBAAiB;YACnB;QACF;IACF;IAEA,oBAAoB;IACpB,MAAM,wBAAwB,UAAU,MAAM,CAAC,CAAA,IAAK,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC;QAChE,MAAM,SAAS;YAAC,EAAE,KAAK,CAAE,OAAO;YAAE,EAAE,KAAK,CAAE,WAAW;YAAE,EAAE,KAAK,CAAE,IAAI;YAAE,EAAE,KAAK,CAAE,QAAQ;SAAC;QACzF,OAAO,KAAK,GAAG,IAAI,OAAO,GAAG,CAAC,CAAC,IAAM,GAAG,cAAc;IACxD;IACA,MAAM,yBACJ,sBAAsB,MAAM,GAAG,IAC3B,sBAAsB,MAAM,CAAC,CAAC,GAAG,IAAM,IAAI,GAAG,KAAK,sBAAsB,MAAM,GAC/E;IAEN,OAAO;QACL;QACA,mBAAmB;YACjB,SAAS,eAAe;YACxB,aAAa,eAAe;YAC5B,MAAM,eAAe;YACrB,UAAU,eAAe;QAC3B;QACA;QACA;QACA,yBAAyB,wBAAwB,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,eAAe,GAAG,EAAE,eAAe;QACrG,SAAS;YACP,YAAY,cAAc,MAAM;YAChC,0BAA0B,cAAc,MAAM;YAC9C;YACA,aAAa,YAAY,MAAM;YAC/B,cAAc,aAAa,MAAM;YACjC,yBAAyB,wBAAwB,MAAM;QACzD;IACF;AACF"}}]
}