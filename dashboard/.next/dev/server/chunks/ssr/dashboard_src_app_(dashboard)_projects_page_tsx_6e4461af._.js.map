{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/karim-f/Code/nivostack-monorepo-checkout/dashboard/src/app/%28dashboard%29/projects/page.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState } from 'react'\nimport Link from 'next/link'\nimport { useAuth } from '@/components/AuthProvider'\nimport { api } from '@/lib/api'\n\ntype Project = {\n  id: string\n  name: string\n  apiKey: string\n  createdAt: string\n  _count: {\n    devices: number\n    logs: number\n    crashes: number\n    apiTraces: number\n  }\n}\n\ntype UsageStats = {\n  projects: {\n    used: number\n    limit: number | null\n    percentage: number\n  }\n}\n\nexport default function ProjectsPage() {\n  const { token } = useAuth()\n  const [projects, setProjects] = useState<Project[]>([])\n  const [loading, setLoading] = useState(true)\n  const [usageStats, setUsageStats] = useState<UsageStats | null>(null)\n  const [showCreateModal, setShowCreateModal] = useState(false)\n  const [newProjectName, setNewProjectName] = useState('')\n  const [creating, setCreating] = useState(false)\n  const [createError, setCreateError] = useState('')\n\n  const fetchProjects = async () => {\n    if (!token) return\n    try {\n      const data = await api.projects.list(token)\n      setProjects(data.projects)\n    } catch (error) {\n      console.error('Failed to fetch projects:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const fetchUsageStats = async () => {\n    if (!token) return\n    try {\n      const data = await api.subscription.getUsage(token)\n      if (data && data.usage) {\n        setUsageStats({\n          projects: data.usage.projects || { used: 0, limit: null, percentage: 0 }\n        })\n      }\n    } catch (error) {\n      console.error('Failed to fetch usage stats:', error)\n    }\n  }\n\n  useEffect(() => {\n    fetchProjects()\n    fetchUsageStats()\n  }, [token])\n\n  const isLimitReached = () => {\n    if (!usageStats) return false\n    const { used, limit } = usageStats.projects\n    return limit !== null && used >= limit\n  }\n\n  const handleCreateProject = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!token || !newProjectName.trim()) return\n\n    setCreating(true)\n    setCreateError('')\n    try {\n      await api.projects.create(newProjectName, token)\n      setNewProjectName('')\n      setShowCreateModal(false)\n      fetchProjects()\n      fetchUsageStats() // Refresh usage stats after creating\n    } catch (error: any) {\n      const errorMessage = error?.response?.data?.error || error?.message || 'Failed to create project'\n      setCreateError(errorMessage)\n      console.error('Failed to create project:', error)\n    } finally {\n      setCreating(false)\n    }\n  }\n\n  if (loading) {\n    return <div className=\"text-gray-400\">Loading projects...</div>\n  }\n\n  const limitReached = isLimitReached()\n  const projectsUsage = usageStats?.projects\n\n  return (\n    <div>\n      {/* Warning Banner */}\n      {limitReached && (\n        <div className=\"mb-6 bg-yellow-900/20 border border-yellow-600 text-yellow-400 px-4 py-3 rounded-lg\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"font-medium\">Project limit reached</p>\n              <p className=\"text-sm text-yellow-300 mt-1\">\n                You have used {projectsUsage?.used} of {projectsUsage?.limit} projects. \n                <Link href=\"/subscription\" className=\"underline ml-1 hover:text-yellow-200\">\n                  Upgrade your plan\n                </Link>\n                {' '}to create more projects.\n              </p>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Usage Info */}\n      {usageStats && !limitReached && projectsUsage && projectsUsage.limit !== null && (\n        <div className=\"mb-6 bg-gray-900 border border-gray-800 rounded-lg p-4\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-sm text-gray-400\">Projects Usage</span>\n            <span className=\"text-sm text-gray-300\">\n              {projectsUsage.used} / {projectsUsage.limit}\n            </span>\n          </div>\n          <div className=\"w-full bg-gray-800 rounded-full h-2\">\n            <div\n              className={`h-2 rounded-full ${\n                projectsUsage.percentage >= 80\n                  ? 'bg-yellow-500'\n                  : projectsUsage.percentage >= 100\n                  ? 'bg-red-500'\n                  : 'bg-blue-500'\n              }`}\n              style={{ width: `${Math.min(projectsUsage.percentage, 100)}%` }}\n            />\n          </div>\n        </div>\n      )}\n\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-2xl font-bold text-white\">Projects</h1>\n        <button\n          onClick={() => setShowCreateModal(true)}\n          disabled={limitReached}\n          className={`px-4 py-2 rounded transition-colors ${\n            limitReached\n              ? 'bg-gray-700 text-gray-500 cursor-not-allowed'\n              : 'bg-blue-600 hover:bg-blue-700 text-white'\n          }`}\n        >\n          New Project\n        </button>\n      </div>\n\n      {projects.length === 0 ? (\n        <div className=\"text-center py-12 bg-gray-900 rounded-lg\">\n          <p className=\"text-gray-400 mb-4\">No projects yet</p>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            disabled={limitReached}\n            className={`px-4 py-2 rounded transition-colors ${\n              limitReached\n                ? 'bg-gray-700 text-gray-500 cursor-not-allowed'\n                : 'bg-blue-600 hover:bg-blue-700 text-white'\n            }`}\n          >\n            Create your first project\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {projects.map((project) => (\n            <Link\n              key={project.id}\n              href={`/projects/${project.id}`}\n              className=\"block p-6 bg-gray-900 rounded-lg hover:bg-gray-800 transition-colors\"\n            >\n              <h2 className=\"text-lg font-semibold text-white mb-2\">{project.name}</h2>\n              <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                <div className=\"text-gray-400\">\n                  <span className=\"text-white font-medium\">{project._count.devices}</span> devices\n                </div>\n                <div className=\"text-gray-400\">\n                  <span className=\"text-white font-medium\">{project._count.logs}</span> logs\n                </div>\n                <div className=\"text-gray-400\">\n                  <span className=\"text-red-400 font-medium\">{project._count.crashes}</span> crashes\n                </div>\n                <div className=\"text-gray-400\">\n                  <span className=\"text-white font-medium\">{project._count.apiTraces}</span> traces\n                </div>\n              </div>\n            </Link>\n          ))}\n        </div>\n      )}\n\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4\">\n          <div className=\"bg-gray-900 rounded-lg p-6 w-full max-w-md\">\n            <h2 className=\"text-xl font-bold text-white mb-4\">Create Project</h2>\n            {limitReached && (\n              <div className=\"mb-4 bg-yellow-900/20 border border-yellow-600 text-yellow-400 px-3 py-2 rounded text-sm\">\n                Project limit reached. Please upgrade your plan to create more projects.\n              </div>\n            )}\n            {createError && (\n              <div className=\"mb-4 bg-red-900/20 border border-red-600 text-red-400 px-3 py-2 rounded text-sm\">\n                {createError}\n              </div>\n            )}\n            <form onSubmit={handleCreateProject}>\n              <input\n                type=\"text\"\n                value={newProjectName}\n                onChange={(e) => {\n                  setNewProjectName(e.target.value)\n                  setCreateError('')\n                }}\n                placeholder=\"Project name\"\n                className=\"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4\"\n                required\n                disabled={limitReached}\n              />\n              <div className=\"flex justify-end space-x-3\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowCreateModal(false)\n                    setCreateError('')\n                    setNewProjectName('')\n                  }}\n                  className=\"px-4 py-2 text-gray-400 hover:text-white transition-colors\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={creating || limitReached}\n                  className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 disabled:cursor-not-allowed text-white rounded transition-colors\"\n                >\n                  {creating ? 'Creating...' : 'Create'}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}