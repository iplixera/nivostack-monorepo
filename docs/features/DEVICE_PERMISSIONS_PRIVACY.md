# Device Information Collection - Permissions & Privacy Guide

## Overview

This document outlines the permissions and privacy considerations for collecting Firebase-like device information in DevBridge SDK.

## Permission Requirements by Property

### ✅ No Permission Required

These properties can be collected without any user consent or system permissions:

1. **deviceCategory** (mobile, tablet, desktop, tv)
   - Determined from screen size and device type
   - No permission needed

2. **deviceBrand** (Samsung, Apple, Google, etc.)
   - Available via device info APIs
   - No permission needed

3. **locale** (en-US, fr-FR, etc.)
   - System locale setting
   - No permission needed

4. **language** (en, fr, etc.)
   - System language setting
   - No permission needed

5. **timeZone** (America/New_York, Europe/London, etc.)
   - System timezone setting
   - No permission needed

6. **timeZoneOffset** (seconds from UTC)
   - Calculated from timezone
   - No permission needed

7. **appId** (Package name / Bundle ID)
   - App metadata
   - No permission needed

8. **appInstanceId** (App instance identifier)
   - Generated by SDK
   - No permission needed

9. **firstOpenAt** (First app open timestamp)
   - App-level tracking
   - No permission needed

10. **firstPurchaseAt** (First purchase timestamp)
    - App-level tracking
    - No permission needed

### ⚠️ Permission/Consent Required

These properties require user consent or have platform-specific restrictions:

#### 1. **advertisingId** (GAID/IDFA) - REQUIRES CONSENT

**iOS (IDFA - Identifier for Advertisers)**:
- Requires explicit user consent via App Tracking Transparency (ATT) framework
- Must show ATT prompt before accessing IDFA
- User can deny tracking (returns all zeros or empty string)
- Required for apps distributed on App Store if you want to access IDFA

**Android (GAID - Google Advertising ID)**:
- Requires user consent per GDPR/CCPA
- Can be accessed without system permission, but:
  - Must respect user's "Opt out of Ads Personalization" setting
  - If user opts out, returns all zeros
  - Privacy policy must disclose collection

**Best Practices**:
- Only collect if user has consented to advertising/tracking
- Check `limitedAdTracking` status before using
- Provide clear privacy policy explaining use
- Allow users to opt-out

#### 2. **vendorId** (IDFV/Android ID) - PLATFORM DEPENDENT

**iOS (IDFV - Identifier for Vendor)**:
- No explicit permission required
- Automatically available to apps from same vendor
- Resets if user uninstalls all apps from vendor
- Privacy-friendly alternative to IDFA

**Android (Android ID)**:
- No system permission required
- Available via `Settings.Secure.ANDROID_ID`
- However:
  - May be restricted on Android 8.0+ (Oreo) for privacy
  - Considered personal data under GDPR
  - Should be disclosed in privacy policy

**Best Practices**:
- Can be used without explicit consent (less sensitive than advertising ID)
- Still should be disclosed in privacy policy
- Prefer vendorId over advertisingId when possible

#### 3. **limitedAdTracking** - No Permission, but Related

- Indicates if user has limited ad tracking enabled
- No permission needed to check this status
- Should be checked before using advertisingId

## Platform-Specific Requirements

### iOS Requirements

1. **App Tracking Transparency (ATT) Framework**:
   - Required for accessing IDFA (advertisingId)
   - Must add `NSUserTrackingUsageDescription` to Info.plist
   - Must request permission using `ATTrackingManager.requestTrackingAuthorization()`
   - User can deny (returns all zeros)

2. **Info.plist Keys**:
   ```xml
   <key>NSUserTrackingUsageDescription</key>
   <string>We use your advertising ID to provide personalized ads and analytics.</string>
   ```

3. **Privacy Manifest** (iOS 17+):
   - May need to declare data collection in Privacy Manifest
   - Required for App Store submission

### Android Requirements

1. **No System Permissions Required**:
   - GAID can be accessed without runtime permissions
   - Android ID available via Settings API

2. **Privacy Policy Requirements**:
   - Must disclose collection of advertising IDs
   - Must allow opt-out per GDPR/CCPA

3. **Google Play Requirements**:
   - Must declare data collection in Play Console
   - Must provide privacy policy URL

## Privacy Regulations

### GDPR (General Data Protection Regulation)

**Requirements**:
- Explicit consent required for advertising IDs
- Must provide clear purpose for collection
- Must allow users to withdraw consent
- Must provide data deletion mechanism

**Affected Properties**:
- `advertisingId` - Requires explicit consent
- `vendorId` - Should be disclosed (may be considered personal data)

### CCPA (California Consumer Privacy Act)

**Requirements**:
- Must disclose collection of personal identifiers
- Must allow opt-out
- Must not discriminate against users who opt-out

**Affected Properties**:
- `advertisingId` - Requires disclosure and opt-out
- `vendorId` - Should be disclosed

### App Store Guidelines

**Apple App Store**:
- Must use ATT framework for IDFA
- Must respect user's tracking preference
- Cannot use workarounds to track users

**Google Play Store**:
- Must declare data collection
- Must provide privacy policy
- Must respect user's ad personalization settings

## Implementation Recommendations

### 1. Consent Management

```dart
// Flutter SDK Example
class DevBridgeSDK {
  bool _hasConsentForAdvertising = false;
  
  Future<void> requestTrackingConsent() async {
    if (Platform.isIOS) {
      // Request ATT permission
      final status = await AppTrackingTransparency.requestTrackingAuthorization();
      _hasConsentForAdvertising = status == TrackingAuthorizationStatus.authorized;
    } else {
      // Check Android ad personalization setting
      // Request user consent via your own UI
      _hasConsentForAdvertising = await requestUserConsent();
    }
  }
  
  Future<Map<String, dynamic>> collectDeviceInfo() async {
    final info = <String, dynamic>{};
    
    // Always collect (no permission needed)
    info['deviceCategory'] = await getDeviceCategory();
    info['deviceBrand'] = await getDeviceBrand();
    info['locale'] = await getLocale();
    info['language'] = await getLanguage();
    info['timeZone'] = await getTimeZone();
    info['appId'] = await getAppId();
    
    // Collect only with consent
    if (_hasConsentForAdvertising) {
      info['advertisingId'] = await getAdvertisingId();
    }
    
    // Vendor ID - collect but disclose in privacy policy
    info['vendorId'] = await getVendorId();
    info['limitedAdTracking'] = await isLimitedAdTracking();
    
    return info;
  }
}
```

### 2. Privacy Policy Requirements

Your privacy policy should disclose:

1. **What data is collected**:
   - Device identifiers (vendor ID, advertising ID if consented)
   - Device properties (brand, model, OS version)
   - Locale and language settings
   - App usage data

2. **Why it's collected**:
   - Analytics and monitoring
   - Debugging and support
   - Performance optimization

3. **How it's used**:
   - Internal analytics
   - Device management
   - Support identification

4. **User rights**:
   - Right to access data
   - Right to delete data
   - Right to opt-out

### 3. SDK Implementation Best Practices

1. **Make Advertising ID Optional**:
   - Only collect if user has consented
   - Check `limitedAdTracking` before using
   - Provide fallback behavior

2. **Respect User Preferences**:
   - Check system-level ad tracking settings
   - Honor user's privacy choices
   - Don't use workarounds

3. **Transparent Collection**:
   - Document what's collected
   - Explain why it's needed
   - Provide opt-out mechanism

4. **Secure Storage**:
   - Encrypt sensitive identifiers
   - Don't store in plain text
   - Follow data retention policies

## Recommended Collection Strategy

### Tier 1: Always Collect (No Permission)
- deviceCategory
- deviceBrand
- locale
- language
- timeZone
- timeZoneOffset
- appId
- appInstanceId
- firstOpenAt
- firstPurchaseAt

### Tier 2: Collect with Disclosure (Vendor ID)
- vendorId (disclose in privacy policy, but no explicit consent required)

### Tier 3: Collect Only with Consent (Advertising ID)
- advertisingId (requires explicit user consent)
- limitedAdTracking (check this before collecting advertising ID)

## SDK Integration Checklist

- [ ] Add ATT framework support for iOS (if collecting advertising ID)
- [ ] Add consent management UI/flow
- [ ] Check `limitedAdTracking` before collecting advertising ID
- [ ] Update privacy policy to disclose data collection
- [ ] Implement opt-out mechanism
- [ ] Add data deletion API endpoint
- [ ] Encrypt sensitive identifiers
- [ ] Test on both iOS and Android
- [ ] Verify App Store/Play Store compliance

## Summary

**No Permission Required** (10 properties):
- deviceCategory, deviceBrand, locale, language, timeZone, timeZoneOffset, appId, appInstanceId, firstOpenAt, firstPurchaseAt

**Consent/Disclosure Required** (2 properties):
- **advertisingId**: Requires explicit user consent (ATT on iOS, GDPR/CCPA compliance)
- **vendorId**: Should be disclosed in privacy policy (less sensitive, but still personal data)

**Best Practice**: 
- Collect Tier 1 properties automatically
- Collect vendorId with privacy policy disclosure
- Only collect advertisingId if user has explicitly consented to tracking

